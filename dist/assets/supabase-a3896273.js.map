{"version":3,"file":"supabase-a3896273.js","sources":["../../scripts/supabase.js"],"sourcesContent":["// supabase.js - Cliente y funciones para Supabase\r\nimport { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';\r\n\r\n// Configuración de Supabase (¡CORREGIDO!)\r\nconst supabaseUrl = 'https://zjgpjbeklpemvogoglyw.supabase.co';\r\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpqZ3BqYmVrbHBlbXZvZ29nbHl3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5NDU0MTcsImV4cCI6MjAzMDUyMTQxN30.82cbK5i_fGOMd-A-UT8A23u-0dGj50aBv2s5Ayq3c5k';\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n\r\n// Funciones para clientes\r\nexport const clientesAPI = {\r\n    // Obtener todos los clientes\r\n    async obtenerTodos() {\r\n        const { data, error } = await supabase\r\n            .from('clientes')\r\n            .select('*')\r\n            .order('fecha_registro', { ascending: false })\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Obtener cliente por ID\r\n    async obtenerPorId(id) {\r\n        const { data, error } = await supabase\r\n            .from('clientes')\r\n            .select('*')\r\n            .eq('id', id)\r\n            .single()\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Crear nuevo cliente\r\n    async crear(cliente) {\r\n        const { data, error } = await supabase\r\n            .from('clientes')\r\n            .insert([cliente])\r\n            .select()\r\n            .single()\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Actualizar cliente\r\n    async actualizar(id, updates) {\r\n        const { data, error } = await supabase\r\n            .from('clientes')\r\n            .update(updates)\r\n            .eq('id', id)\r\n            .select()\r\n            .single()\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Eliminar cliente\r\n    async eliminar(id) {\r\n        const { error } = await supabase\r\n            .from('clientes')\r\n            .delete()\r\n            .eq('id', id)\r\n        \r\n        if (error) throw error\r\n        return true\r\n    }\r\n}\r\n\r\n// Funciones para productos\r\nexport const productosAPI = {\r\n    // Obtener todos los productos\r\n    async obtenerTodos() {\r\n        const { data, error } = await supabase\r\n            .from('productos')\r\n            .select('*')\r\n            .order('fecha_creacion', { ascending: false })\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Obtener productos activos\r\n    async obtenerActivos() {\r\n        const { data, error } = await supabase\r\n            .from('productos')\r\n            .select('*')\r\n            .eq('activo', true)\r\n            .order('nombre')\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Crear nuevo producto\r\n    async crear(producto) {\r\n        const { data, error } = await supabase\r\n            .from('productos')\r\n            .insert([producto])\r\n            .select()\r\n            .single()\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Actualizar producto\r\n    async actualizar(id, updates) {\r\n        const { data, error } = await supabase\r\n            .from('productos')\r\n            .update(updates)\r\n            .eq('id', id)\r\n            .select()\r\n            .single()\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Actualizar stock\r\n    async actualizarStock(id, nuevoStock) {\r\n        const { data, error } = await supabase\r\n            .from('productos')\r\n            .update({ stock: nuevoStock })\r\n            .eq('id', id)\r\n            .select()\r\n            .single()\r\n        \r\n        if (error) throw error\r\n        return data\r\n    }\r\n}\r\n\r\n// Funciones para ventas\r\nexport const ventasAPI = {\r\n    // Obtener todas las ventas con relaciones\r\n    async obtenerTodas() {\r\n        const { data, error } = await supabase\r\n            .from('ventas')\r\n            .select(`\r\n                *,\r\n                clientes (*),\r\n                venta_items (\r\n                    *,\r\n                    productos (*)\r\n                )\r\n            `)\r\n            .order('fecha_venta', { ascending: false })\r\n        \r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Obtener ventas por rango de fechas\r\n    async obtenerPorFecha(fechaInicio, fechaFin) {\r\n        let query = supabase\r\n            .from('ventas')\r\n            .select(`\r\n                *,\r\n                clientes (*),\r\n                venta_items (\r\n                    *,\r\n                    productos (*)\r\n                )\r\n            `)\r\n            .order('fecha_venta', { ascending: false })\r\n\r\n        if (fechaInicio) {\r\n            query = query.gte('fecha_venta', fechaInicio)\r\n        }\r\n        if (fechaFin) {\r\n            query = query.lte('fecha_venta', fechaFin + ' 23:59:59')\r\n        }\r\n\r\n        const { data, error } = await query\r\n        if (error) throw error\r\n        return data\r\n    },\r\n\r\n    // Crear nueva venta (transacción)\r\n    async crear(ventaData) {\r\n        const { venta, items } = ventaData\r\n        \r\n        // Insertar venta\r\n        const { data: ventaCreada, error: errorVenta } = await supabase\r\n            .from('ventas')\r\n            .insert([venta])\r\n            .select()\r\n            .single()\r\n        \r\n        if (errorVenta) throw errorVenta\r\n\r\n        // Insertar items de venta\r\n        const itemsConVentaId = items.map(item => ({\r\n            ...item,\r\n            venta_id: ventaCreada.id\r\n        }))\r\n\r\n        const { error: errorItems } = await supabase\r\n            .from('venta_items')\r\n            .insert(itemsConVentaId)\r\n\r\n        if (errorItems) throw errorItems\r\n\r\n        // Obtener venta completa\r\n        const { data: ventaCompleta, error } = await supabase\r\n            .from('ventas')\r\n            .select(`\r\n                *,\r\n                clientes (*),\r\n                venta_items (\r\n                    *,\r\n                    productos (*)\r\n                )\r\n            `)\r\n            .eq('id', ventaCreada.id)\r\n            .single()\r\n\r\n        if (error) throw error\r\n        return ventaCompleta\r\n    },\r\n\r\n    async eliminar(ventaId) {\r\n        try {\r\n            const { error: errorItems } = await supabase\r\n                .from('venta_items')\r\n                .delete()\r\n                .eq('venta_id', ventaId);\r\n            \r\n            if (errorItems) {\r\n                console.error('Error eliminando items de venta: ', errorItems);\r\n                throw errorItems;\r\n            } \r\n            \r\n            // Luego eliminamos la venta\r\n            const { error: errorVenta } = await supabase\r\n                .from('ventas')\r\n                .delete()\r\n                .eq('id', ventaId);\r\n\r\n            if (errorVenta) {\r\n                console.error('Error eliminando venta:', errorVenta);\r\n                throw errorVenta;\r\n        }\r\n            console.log('Venta eliminada exitosamente:', ventaId);\r\n            return true;\r\n        \r\n        } catch (error) {\r\n            console.error('Error en eliminación completa:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n      // Obtener venta específica con relaciones\r\n    async obtenerPorId(ventaId) {\r\n        const { data, error } = await supabase\r\n            .from('ventas')\r\n            .select(`\r\n                *,\r\n                clientes (*),\r\n                venta_items (\r\n                    *,\r\n                    productos (*)\r\n                )\r\n            `)\r\n            .eq('id', ventaId)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    }\r\n};\r\n\r\nexport const comprasAPI = {\r\n    // Obtener todas las compras con relaciones\r\n    async obtenerTodas() {\r\n        const { data, error } = await supabase\r\n            .from('compras')\r\n            .select(`\r\n                *,\r\n                compra_items (\r\n                    *,\r\n                    productos (*)\r\n                )\r\n            `)\r\n            .order('fecha_compra', { ascending: false })\r\n        \r\n        if (error) throw error;\r\n        return data;\r\n    },\r\n\r\n    // Obtener compra por ID\r\n    async obtenerPorId(compraId) {\r\n        const { data, error } = await supabase\r\n            .from('compras')\r\n            .select(`\r\n                *,\r\n                compra_items (\r\n                    *,\r\n                    productos (*)\r\n                )\r\n            `)\r\n            .eq('id', compraId)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    },\r\n\r\n    // Crear nueva compra (transacción)\r\n    async crear(compraData) {\r\n        const { compra, items } = compraData\r\n        \r\n        // Insertar compra\r\n        const { data: compraCreada, error: errorCompra } = await supabase\r\n            .from('compras')\r\n            .insert([compra])\r\n            .select()\r\n            .single()\r\n        \r\n        if (errorCompra) throw errorCompra\r\n\r\n        // Insertar items de compra\r\n        const itemsConCompraId = items.map(item => ({\r\n            ...item,\r\n            compra_id: compraCreada.id\r\n        }))\r\n\r\n        const { error: errorItems } = await supabase\r\n            .from('compra_items')\r\n            .insert(itemsConCompraId)\r\n\r\n        if (errorItems) throw errorItems\r\n\r\n        // Obtener compra completa\r\n        const { data: compraCompleta, error } = await supabase\r\n            .from('compras')\r\n            .select(`\r\n                *,\r\n                compra_items (\r\n                    *,\r\n                    productos (*)\r\n                )\r\n            `)\r\n            .eq('id', compraCreada.id)\r\n            .single()\r\n\r\n        if (error) throw error\r\n        return compraCompleta\r\n    },\r\n\r\n    // Eliminar compra y sus items\r\n    async eliminar(compraId) {\r\n        // Primero eliminamos los items de la compra\r\n        const { error: errorItems } = await supabase\r\n            .from('compra_items')\r\n            .delete()\r\n            .eq('compra_id', compraId);\r\n\r\n        if (errorItems) throw errorItems;\r\n\r\n        // Luego eliminamos la compra\r\n        const { error: errorCompra } = await supabase\r\n            .from('compras')\r\n            .delete()\r\n            .eq('id', compraId);\r\n\r\n        if (errorCompra) throw errorCompra;\r\n\r\n        return true;\r\n    }\r\n};\r\n\r\n// Funciones para reportes\r\nexport const reportesAPI = {\r\n    // Obtener estadísticas generales\r\n    async obtenerEstadisticas(fechaInicio = null, fechaFin = null) {\r\n        const { data, error } = await supabase\r\n            .rpc('obtener_estadisticas_ventas', {\r\n                fecha_inicio: fechaInicio,\r\n                fecha_fin: fechaFin\r\n            })\r\n        \r\n        if (error) throw error\r\n        return data[0]\r\n    },\r\n\r\n    // Obtener ventas por período\r\n    async obtenerVentasPorPeriodo(periodoTipo, fechaInicio = null, fechaFin = null) {\r\n        const { data, error } = await supabase\r\n            .rpc('obtener_ventas_por_periodo', {\r\n                periodo_tipo: periodoTipo,\r\n                fecha_inicio: fechaInicio,\r\n                fecha_fin: fechaFin\r\n            })\r\n        \r\n        if (error) throw error\r\n        return data\r\n    }\r\n}"],"names":["supabaseUrl","supabaseAnonKey","supabase","createClient","clientesAPI","data","error","id","cliente","updates","productosAPI","producto","nuevoStock","ventasAPI","fechaInicio","fechaFin","query","ventaData","venta","items","ventaCreada","errorVenta","itemsConVentaId","item","errorItems","ventaCompleta","ventaId","comprasAPI","compraId","compraData","compra","compraCreada","errorCompra","itemsConCompraId","compraCompleta"],"mappings":"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"}