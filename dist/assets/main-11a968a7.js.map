{"version":3,"file":"main-11a968a7.js","sources":["../../scripts/dashboard.js","../../scripts/clientes.js","../../scripts/productos.js","../../scripts/ventas.js","../../scripts/compras.js","../../scripts/reportes.js","../../scripts/app.js"],"sourcesContent":["// dashboard.js - Funciones espec√≠ficas del Dashboard\r\nimport { estadoApp, formatearMoneda, mostrarAlerta } from './app.js';\r\n\r\n// Funci√≥n para cargar el dashboard\r\nexport function cargarDashboard() {\r\n    console.log('Cargando dashboard...');\r\n    actualizarEstadisticas('hoy'); // Cargar con 'hoy' por defecto\r\n    actualizarVistasDashboard('hoy');\r\n    configurarMenuSandwich();\r\n    configurarBotonesDashboard();\r\n}\r\n\r\n// Funci√≥n para configurar los botones del dashboard\r\nfunction configurarBotonesDashboard() {\r\n    // Asignar eventos a los botones\r\n    const btnHoy = document.querySelector('.btn-group .btn:nth-child(1)');\r\n    const btnSemana = document.querySelector('.btn-group .btn:nth-child(2)');\r\n    const btnMes = document.querySelector('.btn-group .btn:nth-child(3)');\r\n    \r\n    if (btnHoy) btnHoy.onclick = () => filtrarDashboard('hoy');\r\n    if (btnSemana) btnSemana.onclick = () => filtrarDashboard('semana');\r\n    if (btnMes) btnMes.onclick = () => filtrarDashboard('mes');\r\n}\r\n\r\n// Funci√≥n para configurar el men√∫ sandwich en resoluciones m√≥viles\r\nfunction configurarMenuSandwich() {\r\n    const sandwichBtn = document.getElementById('sandwich-btn');\r\n    const dashboardFilters = document.getElementById('dashboard-filters');\r\n\r\n    if (sandwichBtn && dashboardFilters) {\r\n        sandwichBtn.addEventListener('click', () => {\r\n            dashboardFilters.classList.toggle('is-active');\r\n        });\r\n    }\r\n\r\n    // Opcional: cerrar el men√∫ al hacer clic en una opci√≥n\r\n    dashboardFilters?.addEventListener('click', () => dashboardFilters.classList.remove('is-active'));\r\n}\r\n\r\n// Funci√≥n para filtrar el dashboard por per√≠odo\r\nfunction filtrarDashboard(periodo) {\r\n    console.log(`Filtrando dashboard para: ${periodo}`);\r\n    \r\n    // Remover clase active de todos los botones\r\n    document.querySelectorAll('.btn-group .btn').forEach(btn => {\r\n        btn.classList.remove('active');\r\n    });\r\n    \r\n    // Agregar clase active al bot√≥n seleccionado\r\n    const botones = {\r\n        'hoy': 0,\r\n        'semana': 1,\r\n        'mes': 2\r\n    };\r\n    \r\n    const botonSeleccionado = document.querySelectorAll('.btn-group .btn')[botones[periodo]];\r\n    if (botonSeleccionado) {\r\n        botonSeleccionado.classList.add('active');\r\n    }\r\n    \r\n    // Actualizar estad√≠sticas y gr√°ficos seg√∫n el per√≠odo\r\n    actualizarEstadisticas(periodo);\r\n    actualizarVistasDashboard(periodo);\r\n\r\n    // mostrarAlerta(`Dashboard actualizado: ${periodo}`, 'info');\r\n}\r\n\r\n// Funci√≥n para actualizar las estad√≠sticas del dashboard (MEJORADA)\r\nfunction actualizarEstadisticas(periodo = 'hoy') {\r\n    try {\r\n        const { ventasHoy, ingresosMes, totalVentasPeriodo, promedioVenta } = calcularEstadisticasPorPeriodo(periodo);\r\n        \r\n        // Actualizar elementos del DOM\r\n        const ventasHoyElement = document.getElementById('ventasHoy');\r\n        const ingresosMesElement = document.getElementById('ingresosMes');\r\n        const totalClientesElement = document.getElementById('totalClientes');\r\n        const totalProductosElement = document.getElementById('totalProductos');\r\n        \r\n        if (ventasHoyElement) {\r\n            if (periodo === 'hoy') {\r\n                ventasHoyElement.textContent = formatearMoneda(ventasHoy);\r\n                const label = ventasHoyElement.previousElementSibling;\r\n                if (label) label.textContent = 'VENTAS HOY';\r\n            } else if (periodo === 'semana') {\r\n                ventasHoyElement.textContent = formatearMoneda(totalVentasPeriodo);\r\n                // Cambiar el label temporalmente\r\n                const label = ventasHoyElement.previousElementSibling;\r\n                if (label) label.textContent = 'VENTAS ESTA SEMANA';\r\n            } else if (periodo === 'mes') {\r\n                ventasHoyElement.textContent = formatearMoneda(ingresosMes);\r\n                // Cambiar el label temporalmente\r\n                const label = ventasHoyElement.previousElementSibling;\r\n                if (label) label.textContent = 'VENTAS ESTE MES';\r\n            }\r\n        }\r\n        \r\n        if (ingresosMesElement) ingresosMesElement.textContent = formatearMoneda(ingresosMes);\r\n        if (totalClientesElement) totalClientesElement.textContent = estadoApp.datos.clientes.length;\r\n        if (totalProductosElement) totalProductosElement.textContent = estadoApp.datos.productos.length;\r\n        \r\n    } catch (error) {\r\n        console.error('Error actualizando estad√≠sticas:', error);\r\n    }\r\n}\r\n\r\n// Funci√≥n para calcular estad√≠sticas por per√≠odo\r\nfunction calcularEstadisticasPorPeriodo(periodo) {\r\n    const hoy = new Date();\r\n    let fechaInicio = new Date();\r\n    \r\n    switch (periodo) {\r\n        case 'hoy':\r\n            fechaInicio.setHours(0, 0, 0, 0);\r\n            break;\r\n        case 'semana':\r\n            fechaInicio.setDate(hoy.getDate() - 7);\r\n            break;\r\n        case 'mes':\r\n            fechaInicio.setDate(1); // Primer d√≠a del mes\r\n            break;\r\n        default:\r\n            fechaInicio.setHours(0, 0, 0, 0);\r\n    }\r\n    \r\n    // Filtrar ventas por per√≠odo\r\n    const ventasFiltradas = estadoApp.datos.ventas.filter(venta => {\r\n        if (!venta.fecha_venta) return false;\r\n        const fechaVenta = new Date(venta.fecha_venta);\r\n        return fechaVenta >= fechaInicio && fechaVenta <= hoy;\r\n    });\r\n    \r\n    // Calcular estad√≠sticas\r\n    const ventasHoy = ventasFiltradas.reduce((sum, venta) => sum + (venta.total || 0), 0);\r\n    const totalVentasPeriodo = ventasFiltradas.reduce((sum, venta) => sum + (venta.total || 0), 0);\r\n    \r\n    // Calcular ingresos del mes (siempre del mes completo)\r\n    const inicioMes = new Date();\r\n    inicioMes.setDate(1);\r\n    inicioMes.setHours(0, 0, 0, 0);\r\n    const ingresosMes = estadoApp.datos.ventas\r\n        .filter(venta => venta.fecha_venta && new Date(venta.fecha_venta) >= inicioMes)\r\n        .reduce((sum, venta) => sum + (venta.total || 0), 0);\r\n    \r\n    const promedioVenta = ventasFiltradas.length > 0 ? totalVentasPeriodo / ventasFiltradas.length : 0;\r\n    \r\n    return {\r\n        ventasHoy,\r\n        ingresosMes,\r\n        totalVentasPeriodo,\r\n        promedioVenta,\r\n        cantidadVentas: ventasFiltradas.length\r\n    };\r\n}\r\n\r\n// Funci√≥n para actualizar las vistas del dashboard (Top Clientes y Gr√°fico)\r\nfunction actualizarVistasDashboard(periodo = 'hoy') {\r\n    const datos = generarDatosDashboard(periodo);\r\n\r\n    // Actualizar t√≠tulo\r\n    const titulo = document.getElementById('tituloTopClientes');\r\n    if (titulo) {\r\n        titulo.textContent = `Top Clientes (${getTituloPeriodo(periodo)})`;\r\n    }\r\n\r\n    // Renderizar tabla de Top Clientes\r\n    renderTablaTopClientes(datos.topClientes);\r\n\r\n    // Actualizar gr√°fico de productos populares\r\n    const ctxProductos = document.getElementById('chartProductosPopulares');\r\n    if (ctxProductos) {\r\n        if (ctxProductos.chart) {\r\n            ctxProductos.chart.destroy();\r\n        }\r\n        ctxProductos.chart = new Chart(ctxProductos, {\r\n            type: 'doughnut',\r\n            data: {\r\n                labels: datos.productosPopulares.labels,\r\n                datasets: [{\r\n                    data: datos.productosPopulares.valores,\r\n                    backgroundColor: [\r\n                        '#3498db', '#2ecc71', '#e74c3c', '#f39c12',\r\n                        '#9b59b6', '#1abc9c', '#34495e'\r\n                    ]\r\n                }]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                plugins: {\r\n                    legend: { position: 'bottom' },\r\n                    title: {\r\n                        display: true,\r\n                        text: `Productos M√°s Vendidos (${getTituloPeriodo(periodo)})`\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// Funci√≥n para generar los datos del dashboard (Top Clientes y Productos)\r\nfunction generarDatosDashboard(periodo) {\r\n    const hoy = new Date();\r\n    let fechaInicio = new Date();\r\n    \r\n    switch (periodo) {\r\n        case 'hoy':\r\n            fechaInicio.setHours(0, 0, 0, 0);\r\n            break;\r\n        case 'semana':\r\n            fechaInicio.setDate(hoy.getDate() - 7);\r\n            break;\r\n        case 'mes':\r\n            fechaInicio.setDate(1);\r\n            break;\r\n    }\r\n\r\n    const ventasFiltradas = estadoApp.datos.ventas.filter(venta => {\r\n        if (!venta.fecha_venta) return false;\r\n        const fechaVenta = new Date(venta.fecha_venta);\r\n        return fechaVenta >= fechaInicio && fechaVenta <= hoy;\r\n    });\r\n\r\n    // Calcular Top Clientes\r\n    const clientesAgrupados = {};\r\n    ventasFiltradas.forEach(venta => {\r\n        if (!venta.clientes) return;\r\n        const clienteId = venta.clientes.id;\r\n        if (!clientesAgrupados[clienteId]) {\r\n            clientesAgrupados[clienteId] = {\r\n                nombre: venta.clientes.nombre,\r\n                totalComprado: 0,\r\n                productos: {}\r\n            };\r\n        }\r\n        clientesAgrupados[clienteId].totalComprado += venta.total;\r\n        (venta.venta_items || []).forEach(item => {\r\n            if (!item.productos) return;\r\n            const prodId = item.productos.id;\r\n            if (!clientesAgrupados[clienteId].productos[prodId]) {\r\n                clientesAgrupados[clienteId].productos[prodId] = {\r\n                    nombre: item.productos.nombre,\r\n                    cantidad: 0\r\n                };\r\n            }\r\n            clientesAgrupados[clienteId].productos[prodId].cantidad += item.cantidad;\r\n        });\r\n    });\r\n\r\n    const topClientes = Object.values(clientesAgrupados)\r\n        .sort((a, b) => b.totalComprado - a.totalComprado)\r\n        .slice(0, 10);\r\n\r\n    // Calcular Productos Populares\r\n    const productosAgrupados = {};\r\n    ventasFiltradas.forEach(venta => {\r\n        (venta.venta_items || []).forEach(item => {\r\n            if (!item.productos) return;\r\n            if (!productosAgrupados[item.productos.nombre]) {\r\n                productosAgrupados[item.productos.nombre] = 0;\r\n            }\r\n            productosAgrupados[item.productos.nombre] += item.cantidad;\r\n        });\r\n    });\r\n\r\n    const productosPopularesArray = Object.entries(productosAgrupados)\r\n        .sort(([, a], [, b]) => b - a)\r\n        .slice(0, 5);\r\n\r\n    const productosPopulares = {\r\n        labels: productosPopularesArray.map(([nombre]) => nombre),\r\n        valores: productosPopularesArray.map(([, cantidad]) => cantidad)\r\n    };\r\n\r\n    return {\r\n        topClientes,\r\n        productosPopulares\r\n    };\r\n}\r\n\r\n// Funci√≥n para calcular ventas reales por per√≠odo\r\nfunction calcularVentasReales(periodo) {\r\n    const hoy = new Date();\r\n    let fechaInicio = new Date();\r\n    let labels = [];\r\n    let valores = [];\r\n    \r\n    switch (periodo) {\r\n        case 'hoy':\r\n            // √öltimas 7 horas del d√≠a\r\n            labels = Array.from({length: 7}, (_, i) => {\r\n                const hora = new Date();\r\n                hora.setHours(hora.getHours() - (6 - i));\r\n                return `${hora.getHours()}:00`;\r\n            });\r\n            valores = labels.map(() => Math.random() * 2000 + 500);\r\n            break;\r\n            \r\n        case 'semana':\r\n            // √öltimos 7 d√≠as\r\n            labels = Array.from({length: 7}, (_, i) => {\r\n                const fecha = new Date();\r\n                fecha.setDate(fecha.getDate() - (6 - i));\r\n                return fecha.toLocaleDateString('es-ES', { weekday: 'short' });\r\n            });\r\n            valores = labels.map(() => Math.random() * 3000 + 1000);\r\n            break;\r\n            \r\n        case 'mes':\r\n            // √öltimas 4 semanas\r\n            labels = ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'];\r\n            valores = labels.map(() => Math.random() * 8000 + 2000);\r\n            break;\r\n            \r\n        default:\r\n            labels = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'];\r\n            valores = [1200, 1900, 1500, 2100, 1800, 2500, 2200];\r\n    }\r\n    \r\n    return { labels, valores };\r\n}\r\n\r\n// Nueva funci√≥n para renderizar la tabla de Top Clientes\r\nfunction renderTablaTopClientes(clientes) {\r\n    const container = document.getElementById('topClientesContainer');\r\n    if (!container) return;\r\n\r\n    if (clientes.length === 0) {\r\n        container.innerHTML = `<p class=\"text-center text-muted mt-4\">No hay ventas en este per√≠odo.</p>`;\r\n        return;\r\n    }\r\n\r\n    container.innerHTML = `\r\n        <table class=\"table table-sm table-hover\">\r\n            <thead>\r\n                <tr>\r\n                    <th>#</th>\r\n                    <th>Cliente</th>\r\n                    <th class=\"text-end\">Total Comprado</th>\r\n                    <th>Productos Comprados (Cant.)</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                ${clientes.map((cliente, index) => `\r\n                    <tr>\r\n                        <td>${index + 1}</td>\r\n                        <td><strong>${cliente.nombre}</strong></td>\r\n                        <td class=\"text-end fw-bold text-success\">${formatearMoneda(cliente.totalComprado)}</td>\r\n                        <td>\r\n                            <small class=\"text-muted\">${Object.values(cliente.productos).map(p => `${p.nombre} (${p.cantidad})`).join(', ')}</small>\r\n                        </td>\r\n                    </tr>\r\n                `).join('')}\r\n            </tbody>\r\n        </table>\r\n    `;\r\n}\r\n\r\n// Funci√≥n auxiliar para obtener t√≠tulo del per√≠odo\r\nfunction getTituloPeriodo(periodo) {\r\n    const titulos = {\r\n        'hoy': 'Hoy',\r\n        'semana': 'Esta Semana',\r\n        'mes': 'Este Mes'\r\n    };\r\n    return titulos[periodo] || 'Recientes';\r\n}\r\n\r\n// Exportar funciones al scope global para el HTML\r\nwindow.filtrarDashboard = filtrarDashboard;","// clientes.js - Funciones para la gesti√≥n de clientes\r\nimport { estadoApp, mostrarAlerta, formatearFecha } from './app.js';\r\nimport { clientesAPI } from './supabase.js';\r\n\r\n// Variable para controlar el modo de edici√≥n\r\nlet clienteEditandoId = null;\r\n\r\n// Funci√≥n para cargar la secci√≥n de clientes\r\nexport async function cargarClientes() {\r\n    console.log('Cargando clientes desde Supabase...');\r\n    //await actualizarTablaClientes();\r\n    try {\r\n        const clientes = await clientesAPI.obtenerTodos();\r\n        estadoApp.datos.clientes = clientes;\r\n        actualizarTablaClientes();\r\n        configurarModalCliente();\r\n    } catch (error) {\r\n        console.error('Error cargando clientes:', error);\r\n        mostrarAlerta('Error al cargar clientes: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para actualizar la tabla de clientes\r\nfunction actualizarTablaClientes() {\r\n    const tbody = document.getElementById('tablaClientes');\r\n    \r\n    if (estadoApp.datos.clientes.length === 0) {\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"6\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-people display-4\"></i>\r\n                    <p class=\"mt-2\">No hay clientes registrados</p>\r\n                    <button class=\"btn btn-primary\" onclick=\"mostrarModalCliente()\">\r\n                        <i class=\"bi bi-plus\"></i> Agregar Primer Cliente\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = estadoApp.datos.clientes.map(cliente => `\r\n        <tr>\r\n            <td>${cliente.nombre}</td>\r\n            <td>${cliente.email}</td>\r\n            <td>${cliente.telefono || '-'}</td>\r\n            <td><span class=\"badge ${getBadgeClassForTipo(cliente.tipo)}\">${cliente.tipo || 'N/A'}</span></td>\r\n            <td>${formatearFecha(cliente.fecha_registro)}</td>\r\n            <td>\r\n                <button class=\"btn btn-sm btn-outline-primary\" onclick=\"editarCliente('${cliente.id}')\">\r\n                    <i class=\"bi bi-pencil\"></i>\r\n                </button>\r\n                <button class=\"btn btn-sm btn-outline-danger\" onclick=\"eliminarCliente('${cliente.id}')\">\r\n                    <i class=\"bi bi-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n}\r\n\r\n// Funci√≥n para obtener la clase de la insignia seg√∫n el tipo de cliente\r\nfunction getBadgeClassForTipo(tipo) {\r\n    switch (tipo) {\r\n        case 'Master':\r\n            return 'bg-primary';\r\n        case 'Revenda':\r\n            return 'bg-info text-dark';\r\n        default:\r\n            return 'bg-secondary';\r\n    }\r\n}\r\n\r\n// Funci√≥n para mostrar el modal de cliente\r\nexport function mostrarModalCliente() {\r\n    // Limpiar el formulario\r\n    document.getElementById('formCliente').reset();\r\n    document.getElementById('tituloModalCliente').textContent = 'Nuevo Cliente';\r\n    clienteEditandoId = null;\r\n\r\n    // Asegurarse de que 'Master' est√© seleccionado por defecto para nuevos clientes\r\n    document.getElementById('tipoMaster').checked = true;\r\n\r\n    // Mostrar el modal\r\n    const modal = new bootstrap.Modal(document.getElementById('modalCliente'));\r\n    modal.show();\r\n}\r\n\r\n// Variable para controlar el modo de edici√≥n\r\n//let clienteEditandoId = null;\r\n\r\n// Funci√≥n para editar un cliente\r\nexport async function editarCliente(clienteId) {\r\n    console.log('Editando cliente:', clienteId);\r\n    try {\r\n        // Buscar el cliente\r\n        const cliente = estadoApp.datos.clientes.find(c => c.id === clienteId);\r\n        \r\n        if (cliente) {\r\n            // Guardar ID del cliente que se est√° editando\r\n            clienteEditandoId = clienteId;\r\n            \r\n            // Llenar el formulario con los datos del cliente\r\n            document.getElementById('clienteNombre').value = cliente.nombre;\r\n            document.getElementById('clienteEmail').value = cliente.email;\r\n            document.getElementById('clienteTelefono').value = cliente.telefono || '';\r\n\r\n            // Establecer el tipo de cliente\r\n            if (cliente.tipo === 'Revenda') {\r\n                document.getElementById('tipoRevenda').checked = true;\r\n            } else {\r\n                // Por defecto o si es 'Master'\r\n                document.getElementById('tipoMaster').checked = true;\r\n            }\r\n            \r\n            // Cambiar t√≠tulo del modal\r\n            document.getElementById('tituloModalCliente').textContent = 'Editar Cliente';\r\n            \r\n            // Mostrar modal\r\n            const modal = new bootstrap.Modal(document.getElementById('modalCliente'));\r\n            modal.show();\r\n        } else {\r\n            mostrarAlerta('Cliente no encontrado', 'danger');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error editando cliente:', error);\r\n        mostrarAlerta('Error al cargar datos del cliente: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para guardar un cliente\r\nexport async function guardarCliente() {\r\n    const formulario = document.getElementById('formCliente');\r\n    \r\n    // Validar formulario\r\n    if (!formulario.checkValidity()) {\r\n        formulario.reportValidity();\r\n        return;\r\n    }\r\n    \r\n    // Obtener datos del formulario\r\n    const datosCliente = {\r\n        nombre: document.getElementById('clienteNombre').value,\r\n        email: document.getElementById('clienteEmail').value,\r\n        telefono: document.getElementById('clienteTelefono').value,\r\n        tipo: document.querySelector('input[name=\"tipoCliente\"]:checked').value,\r\n        user_id: estadoApp.datos.usuario.id, // <-- A√ëADIR ID DEL USUARIO\r\n        fecha_registro: new Date().toISOString()\r\n    };\r\n    \r\n    // Validar email √∫nico (excepto para el cliente que se est√° editando)\r\n    const emailExistente = estadoApp.datos.clientes.find(cliente => \r\n        cliente.email === datosCliente.email && cliente.id !== clienteEditandoId\r\n    );\r\n    if (emailExistente) {\r\n        mostrarAlerta('Ya existe un cliente con este email', 'warning');\r\n        return;\r\n    }\r\n     try {\r\n        if (clienteEditandoId) {\r\n            // No actualizamos la fecha de registro al editar\r\n            delete datosCliente.fecha_registro;\r\n            // Tampoco el user_id\r\n            delete datosCliente.user_id;\r\n            // Modo edici√≥n - Actualizar cliente existente\r\n            await clientesAPI.actualizar(clienteEditandoId, datosCliente);\r\n            mostrarAlerta('Cliente actualizado exitosamente', 'success');\r\n        } else {\r\n            // Modo nuevo - Crear nuevo cliente (la fecha ya est√° incluida)\r\n            await clientesAPI.crear(datosCliente);\r\n            mostrarAlerta('Cliente guardado exitosamente', 'success');\r\n        }\r\n        \r\n        // Recargar clientes desde Supabase\r\n        await cargarClientes();\r\n        \r\n        // Cerrar modal\r\n        const modal = bootstrap.Modal.getInstance(document.getElementById('modalCliente'));\r\n        modal.hide();\r\n        \r\n    } catch (error) {\r\n        console.error('Error guardando cliente:', error);\r\n        mostrarAlerta('Error al guardar cliente: ' + error.message, 'danger');\r\n    }\r\n}\r\n \r\n// Funci√≥n para eliminar cliente (mejorada)\r\nexport async function eliminarCliente(clienteId) {\r\n    if (!confirm('¬øEst√°s seguro de que quieres eliminar este cliente?')) {\r\n        return;\r\n    }\r\n    \r\n    try {\r\n        await clientesAPI.eliminar(clienteId);\r\n        mostrarAlerta('Cliente eliminado exitosamente', 'success');\r\n        \r\n        // Recargar clientes desde Supabase\r\n        await cargarClientes();\r\n        \r\n    } catch (error) {\r\n        console.error('Error eliminando cliente:', error);\r\n        mostrarAlerta('Error al eliminar cliente: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para resetear el modal cuando se cierra\r\nfunction configurarModalCliente() {\r\n    const modal = document.getElementById('modalCliente');\r\n    \r\n    modal.addEventListener('hidden.bs.modal', function () {\r\n        // Limpiar el formulario\r\n        document.getElementById('formCliente').reset();\r\n        document.getElementById('tituloModalCliente').textContent = 'Nuevo Cliente';\r\n\r\n        // Resetear radio buttons\r\n        document.getElementById('tipoMaster').checked = true;\r\n        \r\n        // Resetear estado de edici√≥n\r\n        clienteEditandoId = null;\r\n    });\r\n}\r\n\r\n// Funci√≥n para filtrar clientes (placeholder)\r\nexport function filtrarClientes() {\r\n    const filtroNombre = document.getElementById('filtroNombre').value.toLowerCase();\r\n    const filtroEmail = document.getElementById('filtroEmail').value.toLowerCase();\r\n    \r\n    let clientesFiltrados = estadoApp.datos.clientes;\r\n    \r\n    // Aplicar filtros\r\n    if (filtroNombre) {\r\n        clientesFiltrados = clientesFiltrados.filter(cliente => \r\n            cliente.nombre.toLowerCase().includes(filtroNombre)\r\n        );\r\n    }\r\n    \r\n    if (filtroEmail) {\r\n        clientesFiltrados = clientesFiltrados.filter(cliente => \r\n            cliente.email.toLowerCase().includes(filtroEmail)\r\n        );\r\n    }\r\n    \r\n    // Actualizar tabla con clientes filtrados\r\n    const tbody = document.getElementById('tablaClientes');\r\n    \r\n    if (clientesFiltrados.length === 0) {\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"5\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-search display-4\"></i>\r\n                    <p class=\"mt-2\">No se encontraron clientes</p>\r\n                    <button class=\"btn btn-outline-primary\" onclick=\"limpiarFiltrosClientes()\">\r\n                        <i class=\"bi bi-arrow-clockwise\"></i> Limpiar filtros\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = clientesFiltrados.map(cliente => `\r\n        <tr>\r\n            <td>${cliente.nombre}</td>\r\n            <td>${cliente.email}</td>\r\n            <td>${cliente.telefono || '-'}</td>\r\n            <td><span class=\"badge ${getBadgeClassForTipo(cliente.tipo)}\">${cliente.tipo || 'N/A'}</span></td>\r\n            <td>${formatearFecha(cliente.fecha_registro)}</td>\r\n            <td>\r\n                <button class=\"btn btn-sm btn-outline-primary\" onclick=\"editarCliente('${cliente.id}')\">\r\n                    <i class=\"bi bi-pencil\"></i>\r\n                </button>\r\n                <button class=\"btn btn-sm btn-outline-danger\" onclick=\"eliminarCliente('${cliente.id}')\">\r\n                    <i class=\"bi bi-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n}\r\n\r\n// Funci√≥n para limpiar filtros de clientes\r\nexport function limpiarFiltrosClientes() {\r\n    document.getElementById('filtroNombre').value = '';\r\n    document.getElementById('filtroEmail').value = '';\r\n    \r\n    actualizarTablaClientes();\r\n    mostrarAlerta('Filtros limpiados', 'info');\r\n}\r\n\r\n// Exportar funciones al scope global para el HTML\r\nwindow.mostrarModalCliente = mostrarModalCliente;\r\nwindow.editarCliente = editarCliente;\r\nwindow.guardarCliente = guardarCliente;\r\nwindow.eliminarCliente = eliminarCliente;\r\nwindow.filtrarClientes = filtrarClientes;\r\nwindow.limpiarFiltrosClientes = limpiarFiltrosClientes;","// productos.js - Funciones para la gesti√≥n de productos\r\nimport { estadoApp, formatearMoneda, formatearFecha, mostrarAlerta } from './app.js';\r\nimport { productosAPI } from './supabase.js';\r\n\r\nlet productoEditandoId = null;\r\n\r\n// Funci√≥n para cargar la secci√≥n de productos\r\nexport function cargarProductos() {\r\n    console.log('Cargando productos...');\r\n    actualizarTablaProductos();\r\n}\r\n\r\n// Funci√≥n para actualizar la tabla de productos\r\nfunction actualizarTablaProductos() {\r\n    const tbody = document.getElementById('tablaProductos');\r\n    console.log('üìä Productos en estado:', estadoApp.datos.productos);\r\n    \r\n    if (!tbody) {\r\n        console.error('‚ùå No se encontr√≥ el elemento tablaProductos');\r\n        return;\r\n    }\r\n\r\n    if (!estadoApp.datos.productos || estadoApp.datos.productos.length === 0) {\r\n        console.log('üì≠ No hay productos para mostrar');\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"6\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-box display-4\"></i>\r\n                    <p class=\"mt-2\">No hay productos registrados</p>\r\n                    <button class=\"btn btn-primary\" onclick=\"mostrarModalProducto()\">\r\n                        <i class=\"bi bi-plus\"></i> Agregar Primer Producto\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    console.log('üé® Renderizando', estadoApp.datos.productos.length, 'productos en la tabla');\r\n    \r\n    // Crear el HTML de la tabla\r\n    const html = estadoApp.datos.productos.map(producto => `\r\n        <tr>\r\n            <td>\r\n                <strong>${producto.nombre}</strong>\r\n                ${producto.unidad_medida ? `<br><small class=\"text-muted\">${producto.unidad_medida}</small>` : ''}\r\n            </td>\r\n            <td>${producto.descripcion || '-'}</td>\r\n            <td>\r\n                <span class=\"badge ${producto.stock > 0 ? 'bg-success' : 'bg-danger'}\">\r\n                    ${producto.stock} ${producto.unidad_medida || 'unidades'}\r\n                </span>\r\n            </td>\r\n            <td>\r\n                ${producto.categoria ? \r\n                    `<span class=\"badge bg-info\">${producto.categoria}</span>` : \r\n                    '-'\r\n                }\r\n            </td>\r\n            <td>${formatearFecha(producto.fecha_creacion)}</td>\r\n            <td>\r\n                <button class=\"btn btn-sm btn-outline-primary\" onclick=\"editarProducto('${producto.id}')\">\r\n                    <i class=\"bi bi-pencil\"></i>\r\n                </button>\r\n                <button class=\"btn btn-sm btn-outline-danger\" onclick=\"eliminarProducto('${producto.id}')\">\r\n                    <i class=\"bi bi-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n    \r\n    // Asignar el HTML al tbody\r\n    tbody.innerHTML = html;\r\n    console.log('‚úÖ Tabla actualizada correctamente con', estadoApp.datos.productos.length, 'productos');\r\n}\r\n\r\n// Funci√≥n para mostrar el modal de producto\r\nfunction mostrarModalProducto(productoId = null) {\r\n    const formulario = document.getElementById('formProducto');\r\n    const titulo = document.getElementById('tituloModalProducto');\r\n    \r\n    // Limpiar el formulario\r\n    formulario.reset();\r\n    \r\n    if (productoId) {\r\n        // Modo edici√≥n\r\n        titulo.textContent = 'Editar Producto';\r\n        // Aqu√≠ cargar√≠amos los datos del producto\r\n        console.log('Editando producto:', productoId);\r\n    } else {\r\n        // Modo nuevo\r\n        titulo.textContent = 'Nuevo Producto';\r\n    }\r\n    \r\n    // Mostrar el modal\r\n    const modal = new bootstrap.Modal(document.getElementById('modalProducto'));\r\n    modal.show();\r\n}\r\n\r\n// Funci√≥n para guardar un producto\r\nexport async function guardarProducto() {\r\n    const formulario = document.getElementById('formProducto');\r\n    \r\n    // Valido el formulario\r\n    if (!formulario.checkValidity()) {\r\n        formulario.reportValidity();\r\n        return;\r\n    }\r\n\r\n    const producto = {\r\n        nombre: document.getElementById('productoNombre').value,\r\n        descripcion: document.getElementById('productoDescripcion').value,\r\n        categoria: document.getElementById('productoCategoria').value,\r\n        stock: parseInt(document.getElementById('productoStock').value) || 0,\r\n        unidad_medida: document.getElementById('productoUnidad').value,\r\n        activo: true,\r\n        user_id: estadoApp.datos.usuario.id, // <-- A√ëADIR ID DEL USUARIO\r\n        fecha_creacion: new Date().toISOString()\r\n    };\r\n\r\n    if (producto.stock < 0) {\r\n        mostrarAlerta('El stock no puede ser negativo', 'warning');\r\n        return;\r\n    }\r\n    console.log('üì¶ Datos del producto a guardar:', producto);\r\n\r\n    // Guardar en Supabase\r\n    try {\r\n        let productoGuardado;\r\n        \r\n        if (productoEditandoId) {\r\n            // Modo edici√≥n\r\n            delete producto.fecha_creacion;\r\n            delete producto.user_id;\r\n            productoGuardado = await productosAPI.actualizar(productoEditandoId, producto);\r\n            \r\n            // Actualizar en el estado local\r\n            const index = estadoApp.datos.productos.findIndex(p => p.id === productoEditandoId);\r\n            if (index !== -1) {\r\n                estadoApp.datos.productos[index] = productoGuardado;\r\n            }\r\n            \r\n            mostrarAlerta('Producto actualizado exitosamente', 'success');\r\n        } else {\r\n            // Modo nuevo - SOLUCI√ìN MEJORADA\r\n            productoGuardado = await productosAPI.crear(producto);\r\n            console.log('‚úÖ Producto creado:', productoGuardado);\r\n            \r\n            // SOLUCI√ìN: Agregar al inicio del array y forzar actualizaci√≥n\r\n            estadoApp.datos.productos = [productoGuardado, ...estadoApp.datos.productos];\r\n            \r\n            mostrarAlerta('Producto guardado exitosamente', 'success');\r\n        }\r\n        \r\n        // ACTUALIZAR LA TABLA INMEDIATAMENTE\r\n        actualizarTablaProductos();\r\n        console.log('üîÑ Tabla actualizada. Productos en estado:', estadoApp.datos.productos.length);\r\n        \r\n        // Cerrar modal\r\n        const modal = bootstrap.Modal.getInstance(document.getElementById('modalProducto'));\r\n        modal.hide();\r\n        \r\n    } catch (error) {\r\n        console.error('Error guardando producto:', error);\r\n        mostrarAlerta('Error al guardar producto: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para editar un producto (placeholder)\r\nexport async function editarProducto(productoId) {\r\n    console.log('Editando producto:', productoId);\r\n    \r\n     try {\r\n        // Buscar el producto en los datos cargados\r\n        const producto = estadoApp.datos.productos.find(p => p.id === productoId);\r\n        \r\n        if (producto) {\r\n            // Llenar el formulario con los datos del producto (SIN PRECIO)\r\n            document.getElementById('productoNombre').value = producto.nombre;\r\n            document.getElementById('productoDescripcion').value = producto.descripcion || '';\r\n            document.getElementById('productoCategoria').value = producto.categoria || '';\r\n            document.getElementById('productoStock').value = producto.stock;\r\n            document.getElementById('productoUnidad').value = producto.unidad_medida || 'unidad';\r\n            \r\n            // Mostrar modal en modo edici√≥n\r\n            mostrarModalProducto(productoId);\r\n        } else {\r\n            mostrarAlerta('Producto no encontrado', 'danger');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error editando producto:', error);\r\n        mostrarAlerta('Error al cargar datos del producto: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para eliminar un producto\r\nfunction eliminarProducto(productoId) {\r\n    if (confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {\r\n        // Buscar √≠ndice del producto\r\n        const index = estadoApp.datos.productos.findIndex(p => p.id === productoId);\r\n        \r\n        if (index !== -1) {\r\n            // Eliminar producto\r\n            estadoApp.datos.productos.splice(index, 1);\r\n            \r\n            // Actualizar tabla\r\n            actualizarTablaProductos();\r\n            \r\n            // Mostrar mensaje de √©xito\r\n            mostrarAlerta('Producto eliminado exitosamente', 'success');\r\n        } else {\r\n            mostrarAlerta('Producto no encontrado', 'danger');\r\n        }\r\n    }\r\n}\r\n\r\n// Funci√≥n para filtrar productos\r\nfunction filtrarProductos() {\r\n    const filtroNombre = document.getElementById('filtroProductoNombre').value.toLowerCase();\r\n    const filtroCategoria = document.getElementById('filtroCategoria').value;\r\n    const filtroStock = document.getElementById('filtroStock').value;\r\n    \r\n    let productosFiltrados = estadoApp.datos.productos;\r\n    \r\n    // Aplicar filtros\r\n    if (filtroNombre) {\r\n        productosFiltrados = productosFiltrados.filter(producto => \r\n            producto.nombre.toLowerCase().includes(filtroNombre)\r\n        );\r\n    }\r\n    \r\n    if (filtroCategoria) {\r\n        productosFiltrados = productosFiltrados.filter(producto => \r\n            producto.categoria === filtroCategoria\r\n        );\r\n    }\r\n    \r\n    if (filtroStock === 'disponible') {\r\n        productosFiltrados = productosFiltrados.filter(producto => producto.stock > 0);\r\n    } else if (filtroStock === 'agotado') {\r\n        productosFiltrados = productosFiltrados.filter(producto => producto.stock === 0);\r\n    }\r\n    \r\n    // Actualizar tabla con productos filtrados\r\n    const tbody = document.getElementById('tablaProductos');\r\n    \r\n    if (productosFiltrados.length === 0) {\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"7\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-search display-4\"></i>\r\n                    <p class=\"mt-2\">No se encontraron productos</p>\r\n                    <button class=\"btn btn-outline-primary\" onclick=\"limpiarFiltrosProductos()\">\r\n                        <i class=\"bi bi-arrow-clockwise\"></i> Limpiar filtros\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = productosFiltrados.map(producto => `\r\n        <tr>\r\n            <td>\r\n                <strong>${producto.nombre}</strong>\r\n                ${producto.unidad ? `<br><small class=\"text-muted\">${producto.unidad}</small>` : ''}\r\n            </td>\r\n            <td>${producto.descripcion || '-'}</td>\r\n            <td>${formatearMoneda(producto.precio)}</td>\r\n            <td>\r\n                <span class=\"badge ${producto.stock > 0 ? 'bg-success' : 'bg-danger'}\">\r\n                    ${producto.stock} ${producto.unidad || 'unidades'}\r\n                </span>\r\n            </td>\r\n            <td>\r\n                ${producto.categoria ? \r\n                    `<span class=\"badge bg-info\">${producto.categoria}</span>` : \r\n                    '-'\r\n                }\r\n            </td>\r\n            <td>${formatearFecha(producto.fecha_creacion)}</td>\r\n            <td>\r\n                <button class=\"btn btn-sm btn-outline-primary\" onclick=\"editarProducto('${producto.id}')\">\r\n                    <i class=\"bi bi-pencil\"></i>\r\n                </button>\r\n                <button class=\"btn btn-sm btn-outline-danger\" onclick=\"eliminarProducto('${producto.id}')\">\r\n                    <i class=\"bi bi-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n}\r\n\r\n// Funci√≥n para limpiar filtros de productos\r\nfunction limpiarFiltrosProductos() {\r\n    document.getElementById('filtroProductoNombre').value = '';\r\n    document.getElementById('filtroCategoria').value = '';\r\n    document.getElementById('filtroStock').value = '';\r\n    \r\n    actualizarTablaProductos();\r\n    mostrarAlerta('Filtros limpiados', 'info');\r\n}\r\n\r\nwindow.mostrarModalProducto = mostrarModalProducto;\r\nwindow.guardarProducto = guardarProducto;\r\nwindow.editarProducto = editarProducto;\r\nwindow.eliminarProducto = eliminarProducto;\r\nwindow.filtrarProductos = filtrarProductos;\r\nwindow.limpiarFiltrosProductos = limpiarFiltrosProductos;","// ventas.js - Funciones para la gesti√≥n de ventas\r\nimport { estadoApp, formatearMoneda, formatearFecha, mostrarAlerta, actualizarEstadisticas } from './app.js';\r\nimport { ventasAPI, productosAPI  } from './supabase.js';\r\n\r\n// Estado temporal para la venta en curso\r\nlet ventaEnCurso = {\r\n    clienteId: null,\r\n    productos: [],\r\n    subtotal: 0,\r\n    iva: 0,\r\n    total: 0\r\n};\r\n\r\n// Funci√≥n para cargar la secci√≥n de ventas\r\nexport async function cargarVentas() {\r\n    console.log('Cargando ventas desde Supabase...');\r\n    try {\r\n        const ventas = await ventasAPI.obtenerTodas();\r\n        estadoApp.datos.ventas = ventas;\r\n        actualizarTablaVentas();\r\n        cargarSelectClientes();\r\n    } catch (error) {\r\n        console.error('Error cargando ventas:', error);\r\n        mostrarAlerta('Error al cargar ventas: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para actualizar la tabla de ventas\r\nfunction actualizarTablaVentas() {\r\n    const tbody = document.getElementById('tablaVentas');\r\n    \r\n    if (estadoApp.datos.ventas.length === 0) {\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"6\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-cart display-4\"></i>\r\n                    <p class=\"mt-2\">No hay ventas registradas</p>\r\n                    <button class=\"btn btn-primary\" onclick=\"mostrarModalVenta()\">\r\n                        <i class=\"bi bi-plus\"></i> Registrar Primera Venta\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = estadoApp.datos.ventas.map(venta => `\r\n        <tr>\r\n            <td>${formatearFecha(venta.fecha_venta)}</td>\r\n            <td>\r\n                <strong>${venta.clientes ? venta.clientes.nombre : '-'}</strong>\r\n                <br><small class=\"text-muted\">${venta.clientes ? venta.clientes.email : '-'}</small>\r\n            </td>\r\n            <td>\r\n                <small>\r\n                    ${(venta.venta_items || []).map(item => \r\n                        `${item.cantidad} x ${item.productos ? item.productos.nombre : '-'}`\r\n                    ).join('<br>')}\r\n                </small>\r\n            </td>\r\n            <td>${formatearMoneda(venta.total)}</td>\r\n            <td>\r\n                <span class=\"badge bg-success\">Completada</span>\r\n            </td>\r\n            <td>\r\n                <button class=\"btn btn-sm btn-outline-info\" onclick=\"verDetalleVentaModal('${venta.id}')\">\r\n                    <i class=\"bi bi-eye\"></i>\r\n                </button>\r\n                <button class=\"btn btn-sm btn-outline-danger\" onclick=\"eliminarVenta('${venta.id}')\">\r\n                    <i class=\"bi bi-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n}\r\n\r\nfunction editarProductoVenta(index) {\r\n    const producto = ventaEnCurso.productos[index];\r\n    \r\n    // Mostrar modal de edici√≥n\r\n    const modalHTML = `\r\n        <div class=\"modal fade\" id=\"modalEditarProductoVenta\" tabindex=\"-1\">\r\n            <div class=\"modal-dialog\">\r\n                <div class=\"modal-content\">\r\n                    <div class=\"modal-header bg-warning text-white\">\r\n                        <h5 class=\"modal-title\">\r\n                            <i class=\"bi bi-pencil\"></i> Editar Producto en Venta\r\n                        </h5>\r\n                        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\r\n                    </div>\r\n                    <div class=\"modal-body\">\r\n                        <div class=\"mb-3\">\r\n                            <label class=\"form-label\">Producto</label>\r\n                            <input type=\"text\" class=\"form-control\" value=\"${producto.nombre}\" disabled>\r\n                        </div>\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-6\">\r\n                                <label class=\"form-label\">Cantidad</label>\r\n                                <input type=\"number\" class=\"form-control\" id=\"editarCantidad\" \r\n                                       value=\"${producto.cantidad}\" min=\"1\">\r\n                            </div>\r\n                            <div class=\"col-md-6\">\r\n                                <label class=\"form-label\">Precio Unitario</label>\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-text\">$</span>\r\n                                    <input type=\"number\" class=\"form-control\" id=\"editarPrecio\" \r\n                                           value=\"${producto.precio}\" step=\"0.01\" min=\"0.01\">\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        ${producto.precioOriginal ? `\r\n                        <div class=\"mt-2\">\r\n                            <small class=\"text-muted\">\r\n                                Precio original: ${formatearMoneda(producto.precioOriginal)}\r\n                            </small>\r\n                        </div>\r\n                        ` : ''}\r\n                    </div>\r\n                    <div class=\"modal-footer\">\r\n                        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancelar</button>\r\n                        <button type=\"button\" class=\"btn btn-primary\" onclick=\"guardarEdicionProductoVenta(${index})\">\r\n                            <i class=\"bi bi-check\"></i> Guardar Cambios\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    // Remover modal anterior si existe\r\n    const modalAnterior = document.getElementById('modalEditarProductoVenta');\r\n    if (modalAnterior) {\r\n        modalAnterior.remove();\r\n    }\r\n    \r\n    // Agregar nuevo modal al DOM\r\n    document.body.insertAdjacentHTML('beforeend', modalHTML);\r\n    \r\n    // Mostrar modal\r\n    const modal = new bootstrap.Modal(document.getElementById('modalEditarProductoVenta'));\r\n    modal.show();\r\n}\r\n\r\n\r\nfunction guardarEdicionProductoVenta(index) {\r\n    const cantidad = parseInt(document.getElementById('editarCantidad').value) || 1;\r\n    const precio = parseFloat(document.getElementById('editarPrecio').value) || 0;\r\n    \r\n    if (cantidad <= 0) {\r\n        mostrarAlerta('La cantidad debe ser mayor a 0', 'warning');\r\n        return;\r\n    }\r\n    \r\n    if (precio <= 0) {\r\n        mostrarAlerta('El precio debe ser mayor a 0', 'warning');\r\n        return;\r\n    }\r\n    \r\n    // Actualizar producto\r\n    ventaEnCurso.productos[index].cantidad = cantidad;\r\n    ventaEnCurso.productos[index].precio = precio;\r\n    ventaEnCurso.productos[index].subtotal = cantidad * precio;\r\n    \r\n    // Actualizar resumen\r\n    actualizarResumenVenta();\r\n    \r\n    // Cerrar modal\r\n    const modal = bootstrap.Modal.getInstance(document.getElementById('modalEditarProductoVenta'));\r\n    modal.hide();\r\n    \r\n    mostrarAlerta('Producto actualizado en la venta', 'success');\r\n}\r\n\r\n// Funci√≥n para cargar el select de clientes\r\nfunction cargarSelectClientes() {\r\n    const select = document.getElementById('ventaCliente');\r\n    const selectFiltro = document.getElementById('filtroClienteVenta');\r\n    \r\n    const opciones = '<option value=\"\">Seleccionar cliente...</option>' +\r\n        estadoApp.datos.clientes.map(cliente => \r\n            `<option value=\"${cliente.id}\">${cliente.nombre} - ${cliente.email}</option>`\r\n        ).join('');\r\n    \r\n    select.innerHTML = opciones;\r\n    selectFiltro.innerHTML = '<option value=\"\">Todos los clientes</option>' + \r\n        estadoApp.datos.clientes.map(cliente => \r\n            `<option value=\"${cliente.id}\">${cliente.nombre}</option>`\r\n        ).join('');\r\n}\r\n\r\n// Funci√≥n para cargar el select de productos\r\nfunction cargarSelectProductos() {\r\n    const select = document.getElementById('productoSelect');\r\n    \r\n    const opciones = '<option value=\"\">Seleccionar producto...</option>' +\r\n        estadoApp.datos.productos.filter(producto => producto.stock > 0)\r\n        .map(producto => \r\n            `<option value=\"${producto.id}\" \r\n                     data-precio=\"${producto.precio}\" \r\n                     data-stock=\"${producto.stock}\"\r\n                     data-nombre=\"${producto.nombre}\">\r\n                ${producto.nombre} - ${formatearMoneda(producto.precio)} (Stock: ${producto.stock})\r\n            </option>`\r\n        ).join('');\r\n    \r\n    select.innerHTML = opciones;\r\n}\r\n\r\n// Funci√≥n para mostrar el modal de venta\r\nfunction mostrarModalVenta() {\r\n    // Reiniciar la venta en curso\r\n    ventaEnCurso = {\r\n        clienteId: null,\r\n        productos: [],\r\n        subtotal: 0,\r\n        iva: 0,\r\n        total: 0\r\n    };\r\n    \r\n    // Limpiar formularios\r\n    document.getElementById('ventaCliente').value = '';\r\n    document.getElementById('productoSelect').value = '';\r\n    document.getElementById('productoCantidad').value = '1';\r\n    \r\n    // Cargar selects\r\n    cargarSelectClientes();\r\n    cargarSelectProductos();\r\n    \r\n    // Actualizar resumen\r\n    actualizarResumenVenta();\r\n    \r\n    // Mostrar modal\r\n    const modal = new bootstrap.Modal(document.getElementById('modalVenta'));\r\n    modal.show();\r\n}\r\n\r\nwindow.mostrarModalVenta = mostrarModalVenta;\r\n\r\n// Funci√≥n para agregar producto a la venta\r\nfunction agregarProductoVenta() {\r\n    const select = document.getElementById('productoSelect');\r\n    const cantidadInput = document.getElementById('productoCantidad');\r\n    const precioInput = document.getElementById('productoPrecioVenta');\r\n    \r\n    const productoId = select.value;\r\n    const cantidad = parseInt(cantidadInput.value) || 1;\r\n    const precioPersonalizado = parseFloat(precioInput.value) || 0;\r\n\r\n    if (!productoId) {\r\n        mostrarAlerta('Selecciona un producto', 'warning');\r\n        return;\r\n    }\r\n    \r\n    if (cantidad <= 0) {\r\n        mostrarAlerta('La cantidad debe ser mayor a 0', 'warning');\r\n        return;\r\n    }\r\n    \r\n    // Obtener datos del producto seleccionado\r\n    const productoSeleccionado = estadoApp.datos.productos.find(p => p.id === productoId);\r\n    const option = select.options[select.selectedIndex];\r\n    const precioOriginal = parseFloat(option.dataset.precio);\r\n    const stock = parseInt(option.dataset.stock);\r\n    const nombre = option.dataset.nombre;\r\n    // Aca uso el precio que quiero, si no, uso el original\r\n    const precioFinal = precioPersonalizado > 0 ? precioPersonalizado : precioOriginal;\r\n\r\n    // Verificar stock disponible\r\n    if (cantidad > stock) {\r\n        mostrarAlerta(`Stock insuficiente. Solo hay ${stock} unidades disponibles`, 'danger');\r\n        return;\r\n    }\r\n    \r\n    // Verificar si el producto ya est√° en la venta\r\n    const productoExistente = ventaEnCurso.productos.find(p => p.productoId === productoId);\r\n    \r\n    if (productoExistente) {\r\n        // Actualizar cantidad si ya existe\r\n        const nuevaCantidad = productoExistente.cantidad + cantidad;\r\n        \r\n        if (nuevaCantidad > stock) {\r\n            mostrarAlerta(`No puedes agregar m√°s de ${stock} unidades de este producto`, 'danger');\r\n            return;\r\n        }\r\n        \r\n        productoExistente.cantidad = nuevaCantidad;\r\n        productoExistente.precio = precioFinal;\r\n        productoExistente.subtotal = nuevaCantidad * precioFinal;\r\n    } else {\r\n        // Agregar nuevo producto a la venta\r\n        ventaEnCurso.productos.push({\r\n            productoId: productoId,\r\n            nombre: nombre,\r\n            precio: precioFinal,\r\n            precioOriginal: precioOriginal,\r\n            cantidad: cantidad,\r\n            subtotal: cantidad * precioFinal\r\n        });\r\n    }\r\n    \r\n    // Actualizar resumen\r\n    actualizarResumenVenta();\r\n    \r\n    // Limpiar selecci√≥n\r\n    select.value = '';\r\n    cantidadInput.value = '1';\r\n    precioInput.value = '';\r\n\r\n    mostrarAlerta('Producto agregado a la venta', 'success');\r\n}\r\n\r\n// Funci√≥n para actualizar el resumen de la venta\r\nfunction actualizarResumenVenta() {\r\n    const listaProductos = document.getElementById('listaProductosVenta');\r\n    const subtotalElement = document.getElementById('subtotalVenta');\r\n    const ivaElement = document.getElementById('ivaVenta');\r\n    const totalElement = document.getElementById('totalVenta');\r\n    \r\n    // Calcular totales\r\n    ventaEnCurso.subtotal = ventaEnCurso.productos.reduce((sum, producto) => sum + producto.subtotal, 0);\r\n    ventaEnCurso.iva = ventaEnCurso.subtotal * 0.21; // 21% IVA\r\n    ventaEnCurso.total = ventaEnCurso.subtotal + ventaEnCurso.iva;\r\n    \r\n    // Actualizar lista de productos\r\n    if (ventaEnCurso.productos.length === 0) {\r\n        listaProductos.innerHTML = '<p class=\"text-muted text-center\">No hay productos agregados</p>';\r\n    } else {\r\n        listaProductos.innerHTML = ventaEnCurso.productos.map((producto, index) => {\r\n            // Mostrar si el precio fue modificado\r\n            const precioModificado = producto.precioOriginal && producto.precio !== producto.precioOriginal;\r\n            const badgePrecio = precioModificado ? \r\n                `<span class=\"badge bg-warning ms-2\" title=\"Precio original: ${formatearMoneda(producto.precioOriginal)}\">Modificado</span>` : \r\n                '';\r\n            \r\n            return `\r\n                <div class=\"d-flex justify-content-between align-items-center border-bottom pb-2 mb-2\">\r\n                    <div class=\"flex-grow-1\">\r\n                        <strong>${producto.nombre}</strong>\r\n                        ${badgePrecio}\r\n                        <br>\r\n                        <small class=\"text-muted\">\r\n                            ${producto.cantidad} √ó ${formatearMoneda(producto.precio)}\r\n                            ${precioModificado ? `<br><small class=\"text-warning\">Original: ${formatearMoneda(producto.precioOriginal)}</small>` : ''}\r\n                        </small>\r\n                    </div>\r\n                    <div class=\"text-end\">\r\n                        <div class=\"fw-bold\">${formatearMoneda(producto.subtotal)}</div>\r\n                        <div class=\"btn-group btn-group-sm mt-1\">\r\n                            <button class=\"btn btn-outline-primary\" onclick=\"editarProductoVenta(${index})\">\r\n                                <i class=\"bi bi-pencil\"></i>\r\n                            </button>\r\n                            <button class=\"btn btn-outline-danger\" onclick=\"removerProductoVenta(${index})\">\r\n                                <i class=\"bi bi-trash\"></i>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        }).join('');\r\n    }\r\n    \r\n    // Actualizar totales\r\n    subtotalElement.textContent = formatearMoneda(ventaEnCurso.subtotal);\r\n    ivaElement.textContent = formatearMoneda(ventaEnCurso.iva);\r\n    totalElement.textContent = formatearMoneda(ventaEnCurso.total);\r\n}\r\n\r\n// Funci√≥n para remover producto de la venta\r\nfunction removerProductoVenta(index) {\r\n    ventaEnCurso.productos.splice(index, 1);\r\n    actualizarResumenVenta();\r\n    mostrarAlerta('Producto removido de la venta', 'info');\r\n}\r\n\r\n// Funci√≥n para guardar la venta\r\nasync function guardarVenta() {\r\n    const clienteId = document.getElementById('ventaCliente').value;\r\n    \r\n    // Validaciones\r\n    if (!clienteId) {\r\n        mostrarAlerta('Selecciona un cliente', 'warning');\r\n        return;\r\n    }\r\n    \r\n    if (ventaEnCurso.productos.length === 0) {\r\n        mostrarAlerta('Agrega al menos un producto a la venta', 'warning');\r\n        return;\r\n    }\r\n    \r\n    try {\r\n        // Preparar datos para Supabase\r\n        const ventaData = {\r\n            venta: {\r\n                cliente_id: clienteId,\r\n                subtotal: ventaEnCurso.subtotal,\r\n                iva: ventaEnCurso.iva,\r\n                total: ventaEnCurso.total,\r\n                user_id: estadoApp.datos.usuario.id, // <-- A√ëADIR ID DEL USUARIO\r\n                estado: 'completada'\r\n            },\r\n            items: ventaEnCurso.productos.map(p => ({\r\n                producto_id: p.productoId,\r\n                cantidad: p.cantidad,\r\n                precio_unitario: p.precio\r\n            }))\r\n        };\r\n        \r\n        // Guardar en Supabase\r\n        const ventaCreada = await ventasAPI.crear(ventaData);\r\n        \r\n        // Actualizar stock en productos\r\n        for (const item of ventaEnCurso.productos) {\r\n            const producto = estadoApp.datos.productos.find(p => p.id === item.productoId);\r\n            if (producto) {\r\n                const nuevoStock = producto.stock - item.cantidad;\r\n                await productosAPI.actualizarStock(item.productoId, nuevoStock);\r\n            }\r\n        }\r\n        \r\n        // Recargar datos desde Supabase\r\n        estadoApp.datos.ventas = await ventasAPI.obtenerTodas();\r\n        estadoApp.datos.productos = await productosAPI.obtenerTodos();\r\n        \r\n        // Cerrar modal\r\n        const modal = bootstrap.Modal.getInstance(document.getElementById('modalVenta'));\r\n        modal.hide();\r\n        \r\n        // Actualizar interfaz\r\n        actualizarTablaVentas();\r\n        actualizarEstadisticas();\r\n        \r\n        // Mostrar mensaje de √©xito\r\n        mostrarAlerta(`Venta registrada exitosamente por ${formatearMoneda(ventaEnCurso.total)}`, 'success');\r\n        \r\n    } catch (error) {\r\n        console.error('Error guardando venta:', error);\r\n        mostrarAlerta('Error al guardar venta: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para actualizar stock de productos despu√©s de una venta\r\nfunction actualizarStockProductos(productosVendidos) {\r\n    productosVendidos.forEach(productoVendido => {\r\n        const producto = estadoApp.datos.productos.find(p => p.id === productoVendido.productoId);\r\n        if (producto) {\r\n            producto.stock -= productoVendido.cantidad;\r\n            if (producto.stock < 0) producto.stock = 0;\r\n        }\r\n    });\r\n}\r\n\r\n// Funci√≥n para filtrar ventas por fecha\r\nfunction filtrarVentas() {\r\n    const fechaInicio = document.getElementById('fechaInicio').value;\r\n    const fechaFin = document.getElementById('fechaFin').value;\r\n    const clienteId = document.getElementById('filtroClienteVenta').value;\r\n    \r\n    let ventasFiltradas = estadoApp.datos.ventas;\r\n    \r\n    // Aplicar filtros\r\n    if (fechaInicio) {\r\n        ventasFiltradas = ventasFiltradas.filter(venta => \r\n            new Date(venta.fecha_venta) >= new Date(fechaInicio)\r\n        );\r\n    }\r\n    \r\n    if (fechaFin) {\r\n        const fechaFinObj = new Date(fechaFin);\r\n        fechaFinObj.setHours(23, 59, 59, 999); // Incluir todo el d√≠a\r\n        ventasFiltradas = ventasFiltradas.filter(venta => \r\n            new Date(venta.fecha_venta) <= fechaFinObj\r\n        );\r\n    }\r\n    \r\n    if (clienteId) {\r\n        ventasFiltradas = ventasFiltradas.filter(venta => {\r\n            // Manejar diferentes estructuras de cliente\r\n            if (venta.clientes && venta.clientes.id === clienteId) {\r\n                return true;\r\n            } else if (venta.cliente_id === clienteId) {\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    }\r\n    \r\n    // Actualizar tabla con ventas filtradas\r\n    const tbody = document.getElementById('tablaVentas');\r\n    \r\n    if (ventasFiltradas.length === 0) {\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"6\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-search display-4\"></i>\r\n                    <p class=\"mt-2\">No se encontraron ventas</p>\r\n                    <button class=\"btn btn-outline-primary\" onclick=\"limpiarFiltrosVentas()\">\r\n                        <i class=\"bi bi-arrow-clockwise\"></i> Limpiar filtros\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = ventasFiltradas.map(venta => `\r\n        <tr>\r\n            <td>${formatearFecha(venta.fecha_venta)}</td>\r\n            <td>\r\n                <strong>${venta.clientes ? venta.clientes.nombre : 'Cliente no disponible'}</strong>\r\n                <br><small class=\"text-muted\">${venta.clientes ? venta.clientes.email : '-'}</small>\r\n            </td>\r\n            <td>\r\n                <small>\r\n                    ${(venta.venta_items || []).map(item => \r\n                        `${item.cantidad} x ${item.productos ? item.productos.nombre : 'Producto'} - ${formatearMoneda(item.precio_unitario)}`\r\n                    ).join('<br>')}\r\n                </small>\r\n            </td>\r\n            <td>${formatearMoneda(venta.total)}</td>\r\n            <td>\r\n                <span class=\"badge ${venta.estado === 'completada' ? 'bg-success' : venta.estado === 'pendiente' ? 'bg-warning' : 'bg-danger'}\">\r\n                    ${venta.estado}\r\n                </span>\r\n            </td>\r\n            <td>\r\n                <button class=\"btn btn-sm btn-outline-info\" onclick=\"verDetalleVenta('${venta.id}')\">\r\n                    <i class=\"bi bi-eye\"></i>\r\n                </button>\r\n                <button class=\"btn btn-sm btn-outline-danger\" onclick=\"eliminarVenta('${venta.id}')\">\r\n                    <i class=\"bi bi-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n}\r\n\r\n// Funci√≥n para limpiar filtros de ventas\r\nfunction limpiarFiltrosVentas() {\r\n    document.getElementById('fechaInicio').value = '';\r\n    document.getElementById('fechaFin').value = '';\r\n    document.getElementById('filtroClienteVenta').value = '';\r\n    \r\n    actualizarTablaVentas();\r\n    mostrarAlerta('Filtros limpiados', 'info');\r\n}\r\n\r\n// Funci√≥n para ver detalle de venta (placeholder)\r\nfunction verDetalleVentaModal(ventaId) {\r\n    try {\r\n        const venta = estadoApp.datos.ventas.find(v => v.id === ventaId);\r\n        \r\n        if (!venta) {\r\n            mostrarAlerta('Venta no encontrada', 'danger');\r\n            return;\r\n        }\r\n\r\n        // Crear contenido del modal\r\n        const clienteNombre = venta.clientes ? venta.clientes.nombre : 'Cliente no disponible';\r\n        const clienteEmail = venta.clientes ? venta.clientes.email : '-';\r\n        \r\n        const productosHTML = (venta.venta_items || []).map(item => {\r\n            const productoNombre = item.productos ? item.productos.nombre : 'Producto no disponible';\r\n            return `\r\n                <tr>\r\n                    <td>${productoNombre}</td>\r\n                    <td class=\"text-center\">${item.cantidad}</td>\r\n                    <td class=\"text-end\">${formatearMoneda(item.precio_unitario)}</td>\r\n                    <td class=\"text-end\">${formatearMoneda(item.subtotal)}</td>\r\n                </tr>\r\n            `;\r\n        }).join('');\r\n\r\n        const modalHTML = `\r\n            <div class=\"modal fade\" id=\"modalDetalleVenta\" tabindex=\"-1\">\r\n                <div class=\"modal-dialog modal-lg\">\r\n                    <div class=\"modal-content\">\r\n                        <div class=\"modal-header bg-primary text-white\">\r\n                            <h5 class=\"modal-title\">\r\n                                <i class=\"bi bi-receipt\"></i> Detalle de Venta\r\n                            </h5>\r\n                            <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\r\n                        </div>\r\n                        <div class=\"modal-body\">\r\n                            <div class=\"row mb-3\">\r\n                                <div class=\"col-md-6\">\r\n                                    <strong>Cliente:</strong><br>\r\n                                    ${clienteNombre}<br>\r\n                                    <small class=\"text-muted\">${clienteEmail}</small>\r\n                                </div>\r\n                                <div class=\"col-md-6\">\r\n                                    <strong>Fecha:</strong><br>\r\n                                    ${formatearFecha(venta.fecha_venta)}<br>\r\n                                    <span class=\"badge bg-success\">${venta.estado || 'completada'}</span>\r\n                                </div>\r\n                            </div>\r\n                            \r\n                            <div class=\"table-responsive\">\r\n                                <table class=\"table table-sm table-bordered\">\r\n                                    <thead class=\"table-light\">\r\n                                        <tr>\r\n                                            <th>Producto</th>\r\n                                            <th width=\"80\" class=\"text-center\">Cantidad</th>\r\n                                            <th width=\"120\" class=\"text-end\">Precio Unitario</th>\r\n                                            <th width=\"120\" class=\"text-end\">Subtotal</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        ${productosHTML || '<tr><td colspan=\"4\" class=\"text-center text-muted\">No hay productos</td></tr>'}\r\n                                    </tbody>\r\n                                    <tfoot class=\"table-light\">\r\n                                        <tr>\r\n                                            <td colspan=\"3\" class=\"text-end\"><strong>Subtotal:</strong></td>\r\n                                            <td class=\"text-end\"><strong>${formatearMoneda(venta.subtotal)}</strong></td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td colspan=\"3\" class=\"text-end\"><strong>IVA:</strong></td>\r\n                                            <td class=\"text-end\"><strong>${formatearMoneda(venta.iva)}</strong></td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td colspan=\"3\" class=\"text-end\"><strong>Total:</strong></td>\r\n                                            <td class=\"text-end\"><strong class=\"text-success\">${formatearMoneda(venta.total)}</strong></td>\r\n                                        </tr>\r\n                                    </tfoot>\r\n                                </table>\r\n                            </div>\r\n                            \r\n                            ${venta.notas ? `\r\n                            <div class=\"mt-3\">\r\n                                <strong>Notas:</strong><br>\r\n                                <p class=\"text-muted\">${venta.notas}</p>\r\n                            </div>\r\n                            ` : ''}\r\n                        </div>\r\n                        <div class=\"modal-footer\">\r\n                            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cerrar</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        // Remover modal anterior si existe\r\n        const modalAnterior = document.getElementById('modalDetalleVenta');\r\n        if (modalAnterior) {\r\n            modalAnterior.remove();\r\n        }\r\n\r\n        // Agregar nuevo modal al DOM\r\n        document.body.insertAdjacentHTML('beforeend', modalHTML);\r\n        \r\n        // Mostrar modal\r\n        const modal = new bootstrap.Modal(document.getElementById('modalDetalleVenta'));\r\n        modal.show();\r\n\r\n    } catch (error) {\r\n        console.error('Error mostrando detalle de venta:', error);\r\n        mostrarAlerta('Error al mostrar el detalle de la venta', 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para eliminar venta\r\nasync function eliminarVenta(ventaId) {\r\n    if (!confirm('¬øEst√°s seguro de que quieres eliminar esta venta?\\nEsta acci√≥n no se puede deshacer.')) {\r\n        return;\r\n    }\r\n    \r\n   try {\r\n        // 1. Primero obtenemos los detalles de la venta para revertir el stock\r\n        const venta = await ventasAPI.obtenerPorId(ventaId);\r\n        \r\n        if (!venta) {\r\n            mostrarAlerta('Venta no encontrada', 'danger');\r\n            return;\r\n        }\r\n\r\n        console.log('Venta encontrada:', venta);\r\n\r\n        // 2. Revertir el stock de los productos\r\n        if (venta.venta_items && venta.venta_items.length > 0) {\r\n            for (const item of venta.venta_items) {\r\n                const producto = estadoApp.datos.productos.find(p => p.id === item.producto_id);\r\n                if (producto) {\r\n                    const nuevoStock = producto.stock + item.cantidad;\r\n                    await productosAPI.actualizarStock(item.producto_id, nuevoStock);\r\n                    console.log(`Stock revertido para ${producto.nombre}: +${item.cantidad} unidades`);\r\n                }\r\n            }\r\n        } else {\r\n            console.log('No hay items para revertir stock');\r\n        }\r\n\r\n        // 3. Eliminar la venta de Supabase\r\n        await ventasAPI.eliminar(ventaId);\r\n        \r\n        // 4. Actualizar el estado local\r\n        const index = estadoApp.datos.ventas.findIndex(v => v.id === ventaId);\r\n        if (index !== -1) {\r\n            estadoApp.datos.ventas.splice(index, 1);\r\n        }\r\n\r\n        // 5. Recargar datos desde Supabase para asegurar consistencia\r\n        estadoApp.datos.ventas = await ventasAPI.obtenerTodas();\r\n        estadoApp.datos.productos = await productosAPI.obtenerTodos();\r\n\r\n        // 6. Actualizar interfaz\r\n        actualizarTablaVentas();\r\n        actualizarEstadisticas();\r\n\r\n        mostrarAlerta('Venta eliminada exitosamente', 'success');\r\n        \r\n    } catch (error) {\r\n        console.error('Error eliminando venta:', error);\r\n        mostrarAlerta('Error al eliminar venta: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n mejorada para actualizar estad√≠sticas del dashboard\r\nfunction actualizarEstadisticasDashboard() {\r\n    try {\r\n        const hoy = new Date().toISOString().split('T')[0];\r\n        const inicioMes = new Date();\r\n        inicioMes.setDate(1);\r\n        const inicioMesStr = inicioMes.toISOString().split('T')[0];\r\n        \r\n        // Calcular ventas de hoy\r\n        const ventasHoy = estadoApp.datos.ventas\r\n            .filter(v => v.fecha_venta && v.fecha_venta.startsWith(hoy))\r\n            .reduce((sum, v) => sum + (v.total || 0), 0);\r\n        \r\n        // Calcular ingresos del mes\r\n        const ingresosMes = estadoApp.datos.ventas\r\n            .filter(v => v.fecha_venta && v.fecha_venta >= inicioMesStr)\r\n            .reduce((sum, v) => sum + (v.total || 0), 0);\r\n        \r\n        // Actualizar elementos del DOM\r\n        const ventasHoyElement = document.getElementById('ventasHoy');\r\n        const ingresosMesElement = document.getElementById('ingresosMes');\r\n        const totalClientesElement = document.getElementById('totalClientes');\r\n        const totalProductosElement = document.getElementById('totalProductos');\r\n        \r\n        if (ventasHoyElement) ventasHoyElement.textContent = formatearMoneda(ventasHoy);\r\n        if (ingresosMesElement) ingresosMesElement.textContent = formatearMoneda(ingresosMes);\r\n        if (totalClientesElement) totalClientesElement.textContent = estadoApp.datos.clientes.length;\r\n        if (totalProductosElement) totalProductosElement.textContent = estadoApp.datos.productos.length;\r\n        \r\n    } catch (error) {\r\n        console.error('Error actualizando estad√≠sticas:', error);\r\n    }\r\n}\r\n\r\n\r\nwindow.mostrarModalVenta = mostrarModalVenta;\r\nwindow.agregarProductoVenta = agregarProductoVenta;\r\nwindow.removerProductoVenta = removerProductoVenta;\r\nwindow.guardarVenta = guardarVenta;\r\nwindow.filtrarVentas = filtrarVentas;\r\nwindow.limpiarFiltrosVentas = limpiarFiltrosVentas;\r\nwindow.verDetalleVentaModal = verDetalleVentaModal;\r\nwindow.eliminarVenta = eliminarVenta;\r\nwindow.actualizarStockProductos = actualizarStockProductos;\r\nwindow.editarProductoVenta = editarProductoVenta;\r\nwindow.guardarEdicionProductoVenta = guardarEdicionProductoVenta;\r\nwindow.actualizarEstadisticasDashboard = actualizarEstadisticasDashboard;","// compras.js - Gesti√≥n de compras y stock\r\nimport { estadoApp, mostrarAlerta, formatearMoneda, formatearFecha } from './app.js';\r\nimport { comprasAPI, productosAPI } from './supabase.js';\r\n\r\n// Estado temporal para la compra en curso\r\nlet compraEnCurso = {\r\n    proveedor: '',\r\n    numeroFactura: '',\r\n    productos: [],\r\n    subtotal: 0,\r\n    iva: 0,\r\n    total: 0\r\n};\r\n\r\n// Funci√≥n para cargar la secci√≥n de compras\r\nexport async function cargarCompras() {\r\n    console.log('Cargando compras desde Supabase...');\r\n    try {\r\n        const compras = await comprasAPI.obtenerTodas();\r\n        estadoApp.datos.compras = compras;\r\n        actualizarTablaCompras();\r\n        configurarModalCompra();\r\n    } catch (error) {\r\n        console.error('Error cargando compras:', error);\r\n        mostrarAlerta('Error al cargar compras: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para actualizar la tabla de compras\r\nfunction actualizarTablaCompras() {\r\n    const tbody = document.getElementById('tablaCompras');\r\n    \r\n    if (!estadoApp.datos.compras || estadoApp.datos.compras.length === 0) {\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"7\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-box-seam display-4\"></i>\r\n                    <p class=\"mt-2\">No hay compras registradas</p>\r\n                    <button class=\"btn btn-primary\" onclick=\"mostrarModalCompra()\">\r\n                        <i class=\"bi bi-plus\"></i> Registrar Primera Compra\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = estadoApp.datos.compras.map(compra => `\r\n        <tr>\r\n            <td>${formatearFecha(compra.fecha_compra)}</td>\r\n            <td>\r\n                <strong>${compra.proveedor}</strong>\r\n                ${compra.numero_factura ? `<br><small class=\"text-muted\">Factura: ${compra.numero_factura}</small>` : ''}\r\n            </td>\r\n            <td>\r\n                <small>\r\n                    ${(compra.compra_items || []).map(item => \r\n                        `${item.cantidad} x ${item.productos ? item.productos.nombre : 'Producto'}`\r\n                    ).join('<br>')}\r\n                </small>\r\n            </td>\r\n            <td>${formatearMoneda(compra.subtotal)}</td>\r\n            <td>${formatearMoneda(compra.iva)}</td>\r\n            <td>${formatearMoneda(compra.total)}</td>\r\n            <td>\r\n                <span class=\"badge ${compra.estado === 'completada' ? 'bg-success' : compra.estado === 'pendiente' ? 'bg-warning' : 'bg-danger'}\">\r\n                    ${compra.estado}\r\n                </span>\r\n            </td>\r\n            <td>\r\n                <button class=\"btn btn-sm btn-outline-info\" onclick=\"verDetalleCompra('${compra.id}')\">\r\n                    <i class=\"bi bi-eye\"></i>\r\n                </button>\r\n                <button class=\"btn btn-sm btn-outline-danger\" onclick=\"eliminarCompra('${compra.id}')\">\r\n                    <i class=\"bi bi-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n}\r\n\r\n// Funci√≥n para mostrar el modal de compra\r\nexport function mostrarModalCompra() {\r\n    // Reiniciar la compra en curso\r\n    compraEnCurso = {\r\n        proveedor: '',\r\n        numeroFactura: '',\r\n        productos: [],\r\n        subtotal: 0,\r\n        iva: 0,\r\n        total: 0\r\n    };\r\n    \r\n    // Limpiar formularios\r\n    document.getElementById('compraProveedor').value = '';\r\n    document.getElementById('compraNumeroFactura').value = '';\r\n    document.getElementById('productoSelectCompra').value = '';\r\n    document.getElementById('productoCantidadCompra').value = '1';\r\n    document.getElementById('productoPrecioCompra').value = '';\r\n    \r\n    // Cargar select de productos\r\n    cargarSelectProductosCompra();\r\n    \r\n    // Actualizar resumen\r\n    actualizarResumenCompra();\r\n    \r\n    // Mostrar modal\r\n    const modal = new bootstrap.Modal(document.getElementById('modalCompra'));\r\n    modal.show();\r\n}\r\n\r\n// Funci√≥n para cargar el select de productos en compras\r\nfunction cargarSelectProductosCompra() {\r\n    const select = document.getElementById('productoSelectCompra');\r\n    \r\n    const opciones = '<option value=\"\">Seleccionar producto...</option>' +\r\n        estadoApp.datos.productos.map(producto => \r\n            `<option value=\"${producto.id}\" data-nombre=\"${producto.nombre}\">\r\n                ${producto.nombre} (Stock: ${producto.stock})\r\n            </option>`\r\n        ).join('');\r\n    \r\n    select.innerHTML = opciones;\r\n}\r\n\r\n// Funci√≥n para agregar producto a la compra\r\nfunction agregarProductoCompra() {\r\n    const select = document.getElementById('productoSelectCompra');\r\n    const cantidadInput = document.getElementById('productoCantidadCompra');\r\n    const precioInput = document.getElementById('productoPrecioCompra');\r\n    \r\n    const productoId = select.value;\r\n    const cantidad = parseInt(cantidadInput.value) || 1;\r\n    const precio = parseFloat(precioInput.value) || 0;\r\n    \r\n    if (!productoId) {\r\n        mostrarAlerta('Selecciona un producto', 'warning');\r\n        return;\r\n    }\r\n    \r\n    if (cantidad <= 0) {\r\n        mostrarAlerta('La cantidad debe ser mayor a 0', 'warning');\r\n        return;\r\n    }\r\n    \r\n    if (precio <= 0) {\r\n        mostrarAlerta('El precio debe ser mayor a 0', 'warning');\r\n        return;\r\n    }\r\n    \r\n    // Obtener datos del producto seleccionado\r\n    const productoSeleccionado = estadoApp.datos.productos.find(p => p.id === productoId);\r\n    const nombre = productoSeleccionado ? productoSeleccionado.nombre : 'Producto';\r\n    \r\n    // Verificar si el producto ya est√° en la compra\r\n    const productoExistente = compraEnCurso.productos.find(p => p.productoId === productoId);\r\n    \r\n    if (productoExistente) {\r\n        // Actualizar si ya existe\r\n        productoExistente.cantidad = cantidad;\r\n        productoExistente.precioUnitario = precio;\r\n        productoExistente.subtotal = cantidad * precio;\r\n    } else {\r\n        // Agregar nuevo producto a la compra\r\n        compraEnCurso.productos.push({\r\n            productoId: productoId,\r\n            nombre: nombre,\r\n            cantidad: cantidad,\r\n            precioUnitario: precio,\r\n            subtotal: cantidad * precio\r\n        });\r\n    }\r\n    \r\n    // Actualizar resumen\r\n    actualizarResumenCompra();\r\n    \r\n    // Limpiar selecci√≥n\r\n    select.value = '';\r\n    cantidadInput.value = '1';\r\n    precioInput.value = '';\r\n    \r\n    mostrarAlerta('Producto agregado a la compra', 'success');\r\n}\r\n\r\n// Funci√≥n para actualizar el resumen de la compra\r\nfunction actualizarResumenCompra() {\r\n    const listaProductos = document.getElementById('listaProductosCompra');\r\n    const subtotalElement = document.getElementById('subtotalCompra');\r\n    const ivaElement = document.getElementById('ivaCompra');\r\n    const totalElement = document.getElementById('totalCompra');\r\n    \r\n    // Calcular totales\r\n    compraEnCurso.subtotal = compraEnCurso.productos.reduce((sum, producto) => sum + producto.subtotal, 0);\r\n    compraEnCurso.iva = compraEnCurso.subtotal * 0.21; // 21% IVA\r\n    compraEnCurso.total = compraEnCurso.subtotal + compraEnCurso.iva;\r\n    \r\n    // Actualizar lista de productos\r\n    if (compraEnCurso.productos.length === 0) {\r\n        listaProductos.innerHTML = '<p class=\"text-muted text-center\">No hay productos agregados</p>';\r\n    } else {\r\n        listaProductos.innerHTML = compraEnCurso.productos.map((producto, index) => `\r\n            <div class=\"d-flex justify-content-between align-items-center border-bottom pb-2 mb-2\">\r\n                <div class=\"flex-grow-1\">\r\n                    <strong>${producto.nombre}</strong><br>\r\n                    <small class=\"text-muted\">\r\n                        ${producto.cantidad} √ó ${formatearMoneda(producto.precioUnitario)}\r\n                    </small>\r\n                </div>\r\n                <div class=\"text-end\">\r\n                    <div class=\"fw-bold\">${formatearMoneda(producto.subtotal)}</div>\r\n                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removerProductoCompra(${index})\">\r\n                        <i class=\"bi bi-trash\"></i>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `).join('');\r\n    }\r\n    \r\n    // Actualizar totales\r\n    subtotalElement.textContent = formatearMoneda(compraEnCurso.subtotal);\r\n    ivaElement.textContent = formatearMoneda(compraEnCurso.iva);\r\n    totalElement.textContent = formatearMoneda(compraEnCurso.total);\r\n}\r\n\r\n// Funci√≥n para remover producto de la compra\r\nfunction removerProductoCompra(index) {\r\n    compraEnCurso.productos.splice(index, 1);\r\n    actualizarResumenCompra();\r\n    mostrarAlerta('Producto removido de la compra', 'info');\r\n}\r\n\r\n// Funci√≥n para guardar la compra\r\nasync function guardarCompra() {\r\n    const proveedor = document.getElementById('compraProveedor').value;\r\n    const numeroFactura = document.getElementById('compraNumeroFactura').value;\r\n    \r\n    // Validaciones\r\n    if (!proveedor.trim()) {\r\n        mostrarAlerta('Ingresa el nombre del proveedor', 'warning');\r\n        return;\r\n    }\r\n    \r\n    if (compraEnCurso.productos.length === 0) {\r\n        mostrarAlerta('Agrega al menos un producto a la compra', 'warning');\r\n        return;\r\n    }\r\n    \r\n    try {\r\n        // Preparar datos para Supabase\r\n        const compraData = {\r\n            compra: {\r\n                proveedor: proveedor.trim(),\r\n                numero_factura: numeroFactura.trim() || null,\r\n                subtotal: compraEnCurso.subtotal,\r\n                iva: compraEnCurso.iva,\r\n                total: compraEnCurso.total,\r\n                user_id: estadoApp.datos.usuario.id, // <-- A√ëADIR ID DEL USUARIO\r\n                estado: 'completada'\r\n            },\r\n            items: compraEnCurso.productos.map(p => ({\r\n                producto_id: p.productoId,\r\n                cantidad: p.cantidad,\r\n                precio_unitario: p.precioUnitario\r\n            }))\r\n        };\r\n        \r\n        // Guardar en Supabase\r\n        const compraCreada = await comprasAPI.crear(compraData);\r\n        \r\n        // Actualizar stock de productos\r\n        for (const item of compraEnCurso.productos) {\r\n            const producto = estadoApp.datos.productos.find(p => p.id === item.productoId);\r\n            if (producto) {\r\n                const nuevoStock = producto.stock + item.cantidad;\r\n                await productosAPI.actualizarStock(item.productoId, nuevoStock);\r\n            }\r\n        }\r\n        \r\n        // Recargar datos desde Supabase\r\n        estadoApp.datos.compras = await comprasAPI.obtenerTodas();\r\n        estadoApp.datos.productos = await productosAPI.obtenerTodos();\r\n        \r\n        // Cerrar modal\r\n        const modal = bootstrap.Modal.getInstance(document.getElementById('modalCompra'));\r\n        modal.hide();\r\n        \r\n        // Actualizar interfaz\r\n        actualizarTablaCompras();\r\n        \r\n        // Mostrar mensaje de √©xito\r\n        mostrarAlerta(`Compra registrada exitosamente por ${formatearMoneda(compraEnCurso.total)}`, 'success');\r\n        \r\n    } catch (error) {\r\n        console.error('Error guardando compra:', error);\r\n        mostrarAlerta('Error al guardar compra: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para ver detalle de compra\r\nfunction verDetalleCompra(compraId) {\r\n    try {\r\n        const compra = estadoApp.datos.compras.find(c => c.id === compraId);\r\n        \r\n        if (!compra) {\r\n            mostrarAlerta('Compra no encontrada', 'danger');\r\n            return;\r\n        }\r\n\r\n        const productosDetalle = (compra.compra_items || []).map(item => {\r\n            const productoNombre = item.productos ? item.productos.nombre : 'Producto no disponible';\r\n            return `- ${item.cantidad} x ${productoNombre} (${formatearMoneda(item.precio_unitario)}) = ${formatearMoneda(item.subtotal)}`;\r\n        }).join('\\n');\r\n\r\n        const detalle = `\r\nDETALLE DE COMPRA\r\n=================\r\nProveedor: ${compra.proveedor}\r\n${compra.numero_factura ? `Factura: ${compra.numero_factura}` : ''}\r\nFecha: ${formatearFecha(compra.fecha_compra)}\r\nEstado: ${compra.estado}\r\nSubtotal: ${formatearMoneda(compra.subtotal)}\r\nIVA: ${formatearMoneda(compra.iva)}\r\nTotal: ${formatearMoneda(compra.total)}\r\n\r\nPRODUCTOS:\r\n${productosDetalle || 'No hay productos registrados'}\r\n\r\n${compra.notas ? `Notas: ${compra.notas}` : ''}\r\n        `.trim();\r\n\r\n        alert(detalle);\r\n\r\n    } catch (error) {\r\n        console.error('Error mostrando detalle de compra:', error);\r\n        mostrarAlerta('Error al mostrar el detalle de la compra', 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para eliminar compra\r\nasync function eliminarCompra(compraId) {\r\n    if (!confirm('¬øEst√°s seguro de que quieres eliminar esta compra? Esta acci√≥n revertir√° el stock.')) {\r\n        return;\r\n    }\r\n    \r\n    try {\r\n        // Obtener detalles de la compra para revertir stock\r\n        const compra = await comprasAPI.obtenerPorId(compraId);\r\n        \r\n        if (!compra) {\r\n            mostrarAlerta('Compra no encontrada', 'danger');\r\n            return;\r\n        }\r\n\r\n        // Revertir el stock de los productos\r\n        for (const item of compra.compra_items || []) {\r\n            const producto = estadoApp.datos.productos.find(p => p.id === item.producto_id);\r\n            if (producto) {\r\n                const nuevoStock = producto.stock - item.cantidad;\r\n                await productosAPI.actualizarStock(item.producto_id, nuevoStock);\r\n            }\r\n        }\r\n\r\n        // Eliminar la compra de Supabase\r\n        await comprasAPI.eliminar(compraId);\r\n        \r\n        // Actualizar estado local\r\n        const index = estadoApp.datos.compras.findIndex(c => c.id === compraId);\r\n        if (index !== -1) {\r\n            estadoApp.datos.compras.splice(index, 1);\r\n        }\r\n\r\n        // Recargar datos para consistencia\r\n        estadoApp.datos.compras = await comprasAPI.obtenerTodas();\r\n        estadoApp.datos.productos = await productosAPI.obtenerTodos();\r\n\r\n        // Actualizar interfaz\r\n        actualizarTablaCompras();\r\n\r\n        mostrarAlerta('Compra eliminada exitosamente', 'success');\r\n        \r\n    } catch (error) {\r\n        console.error('Error eliminando compra:', error);\r\n        mostrarAlerta('Error al eliminar compra: ' + error.message, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para configurar el modal\r\nfunction configurarModalCompra() {\r\n    const modal = document.getElementById('modalCompra');\r\n    \r\n    modal.addEventListener('hidden.bs.modal', function () {\r\n        // Limpiar el formulario\r\n        document.getElementById('formCompra').reset();\r\n        compraEnCurso = {\r\n            proveedor: '',\r\n            numeroFactura: '',\r\n            productos: [],\r\n            subtotal: 0,\r\n            iva: 0,\r\n            total: 0\r\n        };\r\n    });\r\n}\r\n\r\n// Exportar funciones al scope global para el HTML\r\nwindow.mostrarModalCompra = mostrarModalCompra;\r\nwindow.agregarProductoCompra = agregarProductoCompra;\r\nwindow.removerProductoCompra = removerProductoCompra;\r\nwindow.guardarCompra = guardarCompra;\r\nwindow.verDetalleCompra = verDetalleCompra;\r\nwindow.eliminarCompra = eliminarCompra;","// reportes.js - Funciones para reportes y estad√≠sticas\r\nimport { estadoApp, mostrarAlerta, formatearMoneda } from './app.js';\r\nimport { reportesAPI } from './supabase.js';\r\n\r\n\r\n// Estado de los reportes\r\nlet reporteActual = {\r\n    tipo: 'diario',\r\n    fechaInicio: null,\r\n    fechaFin: null,\r\n    datos: []\r\n};\r\n\r\n// Funci√≥n para cargar la secci√≥n de reportes\r\nexport function cargarReportes() {\r\n    console.log('Cargando reportes...');\r\n    \r\n    // Establecer fechas por defecto (√∫ltimos 30 d√≠as)\r\n    const fechaFin = new Date();\r\n    const fechaInicio = new Date();\r\n    fechaInicio.setDate(fechaInicio.getDate() - 30);\r\n    \r\n    document.getElementById('reporteFechaInicio').value = fechaInicio.toISOString().split('T')[0];\r\n    document.getElementById('reporteFechaFin').value = fechaFin.toISOString().split('T')[0];\r\n    \r\n    // Generar reporte inicial\r\n    generarReporte();\r\n}\r\n\r\n// Funci√≥n principal para generar reportes\r\nfunction generarReporte(tipo = null) {\r\n    if (tipo) {\r\n        reporteActual.tipo = tipo;\r\n        document.getElementById('periodoReporte').value = tipo;\r\n    } else {\r\n        reporteActual.tipo = document.getElementById('periodoReporte').value;\r\n    }\r\n    \r\n    // Obtener fechas del formulario\r\n    reporteActual.fechaInicio = document.getElementById('reporteFechaInicio').value;\r\n    reporteActual.fechaFin = document.getElementById('reporteFechaFin').value;\r\n    \r\n    // Validar fechas\r\n    if (!reporteActual.fechaInicio || !reporteActual.fechaFin) {\r\n        mostrarAlerta('Selecciona un rango de fechas v√°lido', 'warning');\r\n        return;\r\n    }\r\n    \r\n    if (new Date(reporteActual.fechaInicio) > new Date(reporteActual.fechaFin)) {\r\n        mostrarAlerta('La fecha de inicio no puede ser mayor a la fecha fin', 'warning');\r\n        return;\r\n    }\r\n    \r\n    // Procesar datos seg√∫n el tipo de reporte\r\n    const datosProcesados = procesarDatosReporte();\r\n    reporteActual.datos = datosProcesados;\r\n    \r\n    // Actualizar interfaz\r\n    actualizarTablaReportes(datosProcesados);\r\n    actualizarGraficosReportes(datosProcesados);\r\n    \r\n    mostrarAlerta(`Reporte ${reporteActual.tipo} generado exitosamente`, 'success');\r\n}\r\n\r\n// Funci√≥n para procesar datos seg√∫n el tipo de reporte\r\nfunction procesarDatosReporte() {\r\n    const ventasFiltradas = filtrarVentasPorFecha();\r\n    \r\n    switch (reporteActual.tipo) {\r\n        case 'diario':\r\n            return generarReporteDiario(ventasFiltradas);\r\n        case 'mensual':\r\n            return generarReporteMensual(ventasFiltradas);\r\n        case 'anual':\r\n            return generarReporteAnual(ventasFiltradas);\r\n        default:\r\n            return generarReporteDiario(ventasFiltradas);\r\n    }\r\n}\r\n\r\n// Funci√≥n para filtrar ventas por el rango de fechas\r\nfunction filtrarVentasPorFecha() {\r\n    const fechaInicio = new Date(reporteActual.fechaInicio);\r\n    const fechaFin = new Date(reporteActual.fechaFin);\r\n    fechaFin.setHours(23, 59, 59, 999); // Incluir todo el d√≠a\r\n    \r\n    return estadoApp.datos.ventas.filter(venta => {\r\n        const fechaVenta = new Date(venta.fecha_venta);\r\n        return fechaVenta >= fechaInicio && fechaVenta <= fechaFin;\r\n    });\r\n}\r\n\r\n// Funci√≥n para generar reporte diario\r\nfunction generarReporteDiario(ventas) {\r\n    const grupos = {};\r\n    \r\n    ventas.forEach(venta => {\r\n        if (!venta.fecha_venta) return;\r\n\r\n        const fecha = new Date(venta.fecha_venta);\r\n        const clave = fecha.toISOString().split('T')[0]; // YYYY-MM-DD\r\n        \r\n        if (!grupos[clave]) {\r\n            grupos[clave] = {\r\n                periodo: clave,\r\n                total_ventas: 0,\r\n                cantidad_ventas: 0,\r\n                clientes_unicos: new Set(),\r\n                productos_vendidos: 0\r\n            };\r\n        }\r\n        \r\n        grupos[clave].total_ventas += venta.total;\r\n        grupos[clave].cantidad_ventas += 1;\r\n        if (venta.clientes && venta.clientes.id) {\r\n            grupos[clave].clientes_unicos.add(venta.clientes.id);\r\n        } else if (venta.cliente_id) {\r\n            grupos[clave].clientes_unicos.add(venta.cliente_id);\r\n        }\r\n         if (venta.venta_items && Array.isArray(venta.venta_items)) {\r\n            grupos[clave].productos_vendidos += venta.venta_items.reduce((sum, item) => \r\n                sum + (item.cantidad || 0), 0\r\n            );\r\n        }\r\n    });\r\n    \r\n    // Convertir Set a count y calcular promedios\r\n    return Object.values(grupos).map(grupo => ({\r\n        ...grupo,\r\n        clientes_atendidos: grupo.clientes_unicos.size,\r\n        promedio_venta: grupo.cantidad_ventas > 0 ? grupo.total_ventas / grupo.cantidad_ventas : 0\r\n    })).sort((a, b) => a.periodo.localeCompare(b.periodo));\r\n}\r\n\r\n// Funci√≥n para generar reporte mensual\r\nfunction generarReporteMensual(ventas) {\r\n    const grupos = {};\r\n    \r\n    ventas.forEach(venta => {\r\n        if (!venta.fecha_venta) return;\r\n\r\n        const fecha = new Date(venta.fecha_venta);\r\n        const clave = fecha.toISOString().substring(0, 7); // YYYY-MM\r\n        \r\n        if (!grupos[clave]) {\r\n            grupos[clave] = {\r\n                periodo: clave,\r\n                total_ventas: 0,\r\n                cantidad_ventas: 0,\r\n                clientes_unicos: new Set(),\r\n                productos_vendidos: 0\r\n            };\r\n        }\r\n        \r\n        grupos[clave].total_ventas += venta.total;\r\n        grupos[clave].cantidad_ventas += 1;\r\n         // Manejar diferentes estructuras de cliente\r\n        if (venta.clientes && venta.clientes.id) {\r\n            grupos[clave].clientes_unicos.add(venta.clientes.id);\r\n        } else if (venta.cliente_id) {\r\n            grupos[clave].clientes_unicos.add(venta.cliente_id);\r\n        }\r\n        \r\n        // Contar productos vendidos\r\n        if (venta.venta_items && Array.isArray(venta.venta_items)) {\r\n            grupos[clave].productos_vendidos += venta.venta_items.reduce((sum, item) => \r\n                sum + (item.cantidad || 0), 0\r\n            );\r\n        }\r\n    });\r\n    \r\n    return Object.values(grupos).map(grupo => ({\r\n        ...grupo,\r\n        clientes_atendidos: grupo.clientes_unicos.size,\r\n        promedio_venta: grupo.cantidad_ventas > 0 ? grupo.total_ventas / grupo.cantidad_ventas : 0\r\n    })).sort((a, b) => a.periodo.localeCompare(b.periodo));\r\n}\r\n\r\n// Funci√≥n para generar reporte anual\r\nfunction generarReporteAnual(ventas) {\r\n    const grupos = {};\r\n    \r\n    ventas.forEach(venta => {\r\n        if (!venta.fecha_venta) return;\r\n\r\n        const fecha = new Date(venta.fecha_venta);\r\n        const clave = fecha.getFullYear().toString(); // YYYY\r\n        \r\n        if (!grupos[clave]) {\r\n            grupos[clave] = {\r\n                periodo: clave,\r\n                total_ventas: 0,\r\n                cantidad_ventas: 0,\r\n                clientes_unicos: new Set(),\r\n                productos_vendidos: 0\r\n            };\r\n        }\r\n        \r\n        grupos[clave].total_ventas += venta.total;\r\n         if (venta.clientes && venta.clientes.id) {\r\n            grupos[clave].clientes_unicos.add(venta.clientes.id);\r\n        } else if (venta.cliente_id) {\r\n            grupos[clave].clientes_unicos.add(venta.cliente_id);\r\n        }\r\n        \r\n        // Contar productos vendidos\r\n        if (venta.venta_items && Array.isArray(venta.venta_items)) {\r\n            grupos[clave].productos_vendidos += venta.venta_items.reduce((sum, item) => \r\n                sum + (item.cantidad || 0), 0\r\n            );\r\n        }\r\n    });\r\n    \r\n    return Object.values(grupos).map(grupo => ({\r\n        ...grupo,\r\n        clientes_atendidos: grupo.clientes_unicos.size,\r\n        promedio_venta: grupo.cantidad_ventas > 0 ? grupo.total_ventas / grupo.cantidad_ventas : 0\r\n    })).sort((a, b) => a.periodo.localeCompare(b.periodo));\r\n}\r\n\r\n// Funci√≥n para actualizar la tabla de reportes\r\nfunction actualizarTablaReportes(datos) {\r\n    const tbody = document.getElementById('tablaReportes');\r\n    \r\n    if (datos.length === 0) {\r\n        tbody.innerHTML = `\r\n            <tr>\r\n                <td colspan=\"5\" class=\"text-center text-muted py-4\">\r\n                    <i class=\"bi bi-graph-up display-4\"></i>\r\n                    <p class=\"mt-2\">No hay datos para el per√≠odo seleccionado</p>\r\n                </td>\r\n            </tr>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = datos.map(item => `\r\n        <tr>\r\n            <td>\r\n                <strong>${formatearPeriodo(item.periodo)}</strong>\r\n            </td>\r\n            <td class=\"fw-bold text-success\">${formatearMoneda(item.total_ventas)}</td>\r\n            <td>\r\n                <span class=\"badge bg-primary\">${item.cantidad_ventas} ventas</span>\r\n            </td>\r\n            <td>${formatearMoneda(item.promedio_venta)}</td>\r\n            <td>\r\n                <span class=\"badge bg-info\">${item.clientes_atendidos} clientes</span>\r\n            </td>\r\n        </tr>\r\n    `).join('');\r\n}\r\n\r\n// Funci√≥n para formatear el per√≠odo seg√∫n el tipo de reporte\r\nfunction formatearPeriodo(periodo) {\r\n    switch (reporteActual.tipo) {\r\n        case 'diario':\r\n            return new Date(periodo).toLocaleDateString('es-ES', {\r\n                year: 'numeric',\r\n                month: 'long',\r\n                day: 'numeric'\r\n            });\r\n        case 'mensual':\r\n            const [year, month] = periodo.split('-');\r\n            return new Date(year, month - 1).toLocaleDateString('es-ES', {\r\n                year: 'numeric',\r\n                month: 'long'\r\n            });\r\n        case 'anual':\r\n            return periodo;\r\n        default:\r\n            return periodo;\r\n    }\r\n}\r\n\r\n// Funci√≥n para actualizar los gr√°ficos de reportes\r\nfunction actualizarGraficosReportes(datos) {\r\n    actualizarGraficoVentasPeriodo(datos);\r\n    actualizarGraficoCategorias();\r\n}\r\n\r\n// Funci√≥n para actualizar el gr√°fico de ventas por per√≠odo\r\nfunction actualizarGraficoVentasPeriodo(datos) {\r\n    const ctx = document.getElementById('chartVentasPeriodo');\r\n    \r\n    if (!ctx) return;\r\n    \r\n    // Destruir gr√°fico anterior si existe\r\n    if (ctx.chart) {\r\n        ctx.chart.destroy();\r\n    }\r\n    \r\n    const labels = datos.map(item => formatearPeriodo(item.periodo));\r\n    const valores = datos.map(item => item.total_ventas);\r\n    \r\n    ctx.chart = new Chart(ctx, {\r\n        type: 'bar',\r\n        data: {\r\n            labels: labels,\r\n            datasets: [{\r\n                label: 'Ventas Totales',\r\n                data: valores,\r\n                backgroundColor: 'rgba(54, 162, 235, 0.8)',\r\n                borderColor: 'rgba(54, 162, 235, 1)',\r\n                borderWidth: 1\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            plugins: {\r\n                title: {\r\n                    display: true,\r\n                    text: `Ventas por Per√≠odo (${reporteActual.tipo})`\r\n                },\r\n                legend: {\r\n                    display: false\r\n                }\r\n            },\r\n            scales: {\r\n                y: {\r\n                    beginAtZero: true,\r\n                    ticks: {\r\n                        callback: function(value) {\r\n                            return formatearMoneda(value);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Funci√≥n para actualizar el gr√°fico de categor√≠as\r\nfunction actualizarGraficoCategorias() {\r\n    const ctx = document.getElementById('chartCategorias');\r\n    \r\n    if (!ctx) return;\r\n    \r\n    // Destruir gr√°fico anterior si existe\r\n    if (ctx.chart) {\r\n        ctx.chart.destroy();\r\n    }\r\n    \r\n    // Calcular ventas por categor√≠a\r\n    const ventasFiltradas = filtrarVentasPorFecha();\r\n    const ventasPorCategoria = calcularVentasPorCategoria(ventasFiltradas);\r\n    \r\n    const labels = Object.keys(ventasPorCategoria);\r\n    const valores = Object.values(ventasPorCategoria);\r\n    \r\n    if (labels.length === 0 || valores.reduce((sum, val) => sum + val, 0) === 0) {\r\n        // Mostrar mensaje de no datos\r\n        ctx.innerHTML = `\r\n            <div class=\"text-center text-muted py-4\">\r\n                <i class=\"bi bi-pie-chart display-4\"></i>\r\n                <p class=\"mt-2\">No hay datos de categor√≠as para el per√≠odo seleccionado</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    ctx.chart = new Chart(ctx, {\r\n        type: 'doughnut',\r\n        data: {\r\n            labels: labels,\r\n            datasets: [{\r\n                data: valores,\r\n                backgroundColor: [\r\n                    '#3498db', '#2ecc71', '#e74c3c', '#f39c12',\r\n                    '#9b59b6', '#1abc9c', '#34495e', '#e67e22',\r\n                    '#16a085', '#27ae60', '#2980b9', '#8e44ad'\r\n                ]\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            plugins: {\r\n                title: {\r\n                    display: true,\r\n                    text: 'Distribuci√≥n por Categor√≠as'\r\n                },\r\n                legend: {\r\n                    position: 'bottom'\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Funci√≥n para calcular ventas por categor√≠a\r\nfunction calcularVentasPorCategoria(ventas) {\r\n    const categorias = {};\r\n    \r\n    ventas.forEach(venta => {\r\n        try {\r\n            // Verificar que la venta tenga items\r\n            if (!venta.venta_items || !Array.isArray(venta.venta_items)) {\r\n                return;\r\n            }\r\n            venta.venta_items.forEach(item => {\r\n                try {\r\n                    let categoria = 'Sin categor√≠a';\r\n                    let subtotal = 0;\r\n                    \r\n                    // Determinar categor√≠a\r\n                    if (item.productos && item.productos.categoria) {\r\n                        categoria = item.productos.categoria;\r\n                    }\r\n                    \r\n                    // Calcular subtotal\r\n                    if (item.subtotal) {\r\n                        subtotal = Number(item.subtotal);\r\n                    } else if (item.precio_unitario && item.cantidad) {\r\n                        subtotal = Number(item.precio_unitario) * Number(item.cantidad);\r\n                    }\r\n                    \r\n                    // Acumular en la categor√≠a\r\n                    if (!categorias[categoria]) {\r\n                        categorias[categoria] = 0;\r\n                    }\r\n                    categorias[categoria] += subtotal;\r\n                    \r\n                } catch (itemError) {\r\n                    console.warn('Error procesando item de venta:', itemError);\r\n                }\r\n            });\r\n            \r\n        } catch (ventaError) {\r\n            console.warn('Error procesando venta para categor√≠as:', ventaError);\r\n        }\r\n    });\r\n    \r\n    return categorias;\r\n}\r\n\r\n// Funci√≥n para cambiar el per√≠odo del reporte\r\nfunction cambiarPeriodoReporte() {\r\n    const periodo = document.getElementById('periodoReporte').value;\r\n    \r\n    // Ajustar fechas seg√∫n el per√≠odo seleccionado\r\n    const fechaFin = new Date();\r\n    let fechaInicio = new Date();\r\n    \r\n    switch (periodo) {\r\n        case 'diario':\r\n            fechaInicio.setDate(fechaInicio.getDate() - 7); // √öltimos 7 d√≠as\r\n            break;\r\n        case 'mensual':\r\n            fechaInicio.setMonth(fechaInicio.getMonth() - 6); // √öltimos 6 meses\r\n            break;\r\n        case 'anual':\r\n            fechaInicio.setFullYear(fechaInicio.getFullYear() - 3); // √öltimos 3 a√±os\r\n            break;\r\n    }\r\n    \r\n    document.getElementById('reporteFechaInicio').value = fechaInicio.toISOString().split('T')[0];\r\n    document.getElementById('reporteFechaFin').value = fechaFin.toISOString().split('T')[0];\r\n    \r\n    // Regenerar reporte\r\n    generarReporte();\r\n}\r\n\r\n// Funci√≥n para exportar reporte a Excel (simulado)\r\nfunction exportarReporte() {\r\n    if (reporteActual.datos.length === 0) {\r\n        mostrarAlerta('No hay datos para exportar', 'warning');\r\n        return;\r\n    }\r\n    \r\n    // Simular exportaci√≥n\r\n    const contenido = generarContenidoExportacion();\r\n    \r\n    // Crear y descargar archivo (simulaci√≥n)\r\n    const blob = new Blob([contenido], { type: 'text/csv' });\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `reporte_${reporteActual.tipo}_${new Date().toISOString().split('T')[0]}.csv`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    window.URL.revokeObjectURL(url);\r\n    \r\n    mostrarAlerta('Reporte exportado exitosamente', 'success');\r\n}\r\n\r\n// Funci√≥n para generar contenido de exportaci√≥n\r\nfunction generarContenidoExportacion() {\r\n    let contenido = 'Per√≠odo,Total Ventas,Cantidad Ventas,Promedio Venta,Clientes Atendidos,Productos Vendidos\\n';\r\n    \r\n    reporteActual.datos.forEach(item => {\r\n        contenido += `\"${formatearPeriodo(item.periodo)}\",${item.total_ventas},${item.cantidad_ventas},${item.promedio_venta},${item.clientes_atendidos},${item.productos_vendidos}\\n`;\r\n    });\r\n    \r\n    return contenido;\r\n}\r\n\r\n// Funci√≥n para generar reporte r√°pido (desde los botones del header)\r\nfunction generarReporteRapido(tipo) {\r\n    // Establecer fechas seg√∫n el tipo\r\n    const fechaFin = new Date();\r\n    let fechaInicio = new Date();\r\n    \r\n    switch (tipo) {\r\n        case 'diario':\r\n            fechaInicio.setDate(fechaInicio.getDate() - 7);\r\n            break;\r\n        case 'mensual':\r\n            fechaInicio.setMonth(fechaInicio.getMonth() - 6);\r\n            break;\r\n        case 'anual':\r\n            fechaInicio.setFullYear(fechaInicio.getFullYear() - 3);\r\n            break;\r\n    }\r\n    \r\n    document.getElementById('reporteFechaInicio').value = fechaInicio.toISOString().split('T')[0];\r\n    document.getElementById('reporteFechaFin').value = fechaFin.toISOString().split('T')[0];\r\n    document.getElementById('periodoReporte').value = tipo;\r\n    \r\n    generarReporte(tipo);\r\n}\r\n\r\nwindow.generarReporte = generarReporte;\r\nwindow.generarReporteRapido = generarReporteRapido;\r\nwindow.cambiarPeriodoReporte = cambiarPeriodoReporte;\r\nwindow.exportarReporte = exportarReporte;","// app.js - Navegaci√≥n y Funciones B√°sicas\r\nimport { supabase, clientesAPI, productosAPI, ventasAPI, comprasAPI, reportesAPI } from './supabase.js'\r\nimport { cargarDashboard } from './dashboard.js';\r\nimport { cargarClientes } from './clientes.js';\r\nimport { cargarProductos } from './productos.js';\r\nimport { cargarVentas } from './ventas.js';\r\nimport { cargarCompras } from './compras.js';\r\nimport { cargarReportes } from './reportes.js';\r\n\r\n\r\n// Estado global de la aplicaci√≥n\r\nexport const estadoApp = {\r\n    seccionActual: 'dashboard',\r\n    datos: {\r\n        clientes: [],\r\n        productos: [],\r\n        ventas: [],\r\n        compras: [],\r\n        usuario: null // Para guardar la info del usuario logueado\r\n    }\r\n};\r\n\r\n// Funci√≥n para mostrar una secci√≥n y ocultar las dem√°s\r\nexport function mostrarSeccion(seccion) {\r\n    // Ocultar todas las secciones\r\n    document.querySelectorAll('.seccion').forEach(sec => {\r\n        sec.style.display = 'none';\r\n    });\r\n    \r\n    // Remover clase active de todos los enlaces\r\n    document.querySelectorAll('.sidebar .nav-link').forEach(link => {\r\n        link.classList.remove('active');\r\n    });\r\n    \r\n    // Mostrar la secci√≥n seleccionada\r\n    const seccionElement = document.getElementById(seccion);\r\n    if (seccionElement) {\r\n        seccionElement.style.display = 'block';\r\n    }\r\n    \r\n    // Activar el enlace correspondiente en el sidebar\r\n    const enlaces = document.querySelectorAll('.sidebar .nav-link');\r\n    enlaces.forEach(link => {\r\n        if (link.textContent.includes(getTituloSeccion(seccion))) {\r\n            link.classList.add('active');\r\n        }\r\n    });\r\n    \r\n    // Actualizar estado\r\n    estadoApp.seccionActual = seccion;\r\n    \r\n    // Cargar datos espec√≠ficos de la secci√≥n\r\n    cargarDatosSeccion(seccion);\r\n}\r\nwindow.mostrarSeccion = mostrarSeccion;\r\n\r\n// Funci√≥n auxiliar para obtener el t√≠tulo de la secci√≥n\r\nfunction getTituloSeccion(seccion) {\r\n    const titulos = {\r\n        'dashboard': 'Dashboard',\r\n        'clientes': 'Clientes',\r\n        'productos': 'Productos',\r\n        'ventas': 'Ventas',\r\n        'compras': 'Compras',\r\n        'reportes': 'Reportes'\r\n    };\r\n    return titulos[seccion] || seccion;\r\n}\r\n\r\n// Funci√≥n para cargar datos seg√∫n la secci√≥n\r\nasync function cargarDatosSeccion(seccion) {\r\n    console.log(`Cargando datos para: ${seccion}`);\r\n    try {\r\n        switch(seccion) {\r\n            case 'dashboard':\r\n                await cargarDashboard();\r\n                break;\r\n            case 'clientes':\r\n                await cargarClientes();\r\n                break;\r\n            case 'productos':\r\n                await cargarProductos();\r\n                break;\r\n            case 'ventas':\r\n                await cargarVentas();\r\n                break;\r\n            case 'compras':\r\n                await cargarCompras();\r\n                break;\r\n            case 'reportes':\r\n                await cargarReportes();\r\n                break;\r\n        }\r\n    } catch (error) {\r\n        console.error(`Error cargando secci√≥n ${seccion}:`, error);\r\n        mostrarAlerta(`Error al cargar ${seccion}: ${error.message}`, 'danger');\r\n    }\r\n}\r\n\r\n// Funci√≥n para mostrar alertas\r\nexport function mostrarAlerta(mensaje, tipo = 'info') {\r\n    const alertContainer = document.getElementById('alertContainer');\r\n    \r\n    const alerta = document.createElement('div');\r\n    alerta.className = `alert alert-${tipo} alert-dismissible fade show`;\r\n    alerta.innerHTML = `\r\n        <i class=\"bi bi-${getIconoAlerta(tipo)}\"></i>\r\n        ${mensaje}\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n    `;\r\n    \r\n    alertContainer.appendChild(alerta);\r\n    \r\n    // Auto-eliminar despu√©s de 5 segundos\r\n    setTimeout(() => {\r\n        if (alerta.parentNode) {\r\n            alerta.remove();\r\n        }\r\n    }, 3000);\r\n}\r\n\r\n// Funci√≥n auxiliar para iconos de alerta\r\nfunction getIconoAlerta(tipo) {\r\n    const iconos = {\r\n        'success': 'check-circle',\r\n        'danger': 'exclamation-triangle',\r\n        'warning': 'exclamation-circle',\r\n        'info': 'info-circle'\r\n    };\r\n    return iconos[tipo] || 'info-circle';\r\n}\r\n\r\n// Funci√≥n para formatear fechas\r\nexport function formatearFecha(fechaString) {\r\n    const opciones = { \r\n        year: 'numeric', \r\n        month: '2-digit', \r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n    };\r\n    return new Date(fechaString).toLocaleDateString('es-ES', opciones);\r\n}\r\n\r\n// Funci√≥n para formatear moneda\r\nexport function formatearMoneda(monto) {\r\n    return new Intl.NumberFormat('es-MX', {\r\n        style: 'currency',\r\n        currency: 'MXN' // Ver si esta bien MXN\r\n    }).format(monto);\r\n}\r\n\r\n// Inicializar la aplicaci√≥n cuando se carga la p√°gina\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    // Configurar la l√≥gica del men√∫ de hamburguesa para m√≥viles, independientemente del login.\r\n    configurarMenuHamburguesa();\r\n\r\n    // Comprobar el estado de autenticaci√≥n\r\n    supabase.auth.onAuthStateChange(async (event, session) => {\r\n        if (session) {\r\n            // Usuario est√° logueado\r\n            console.log('Usuario autenticado:', session.user);\r\n            estadoApp.datos.usuario = session.user;\r\n\r\n            // Si estamos en la p√°gina de login/signup, redirigir a la app principal\r\n            if (window.location.pathname.includes('login.html') || window.location.pathname.includes('signup.html')) {\r\n                window.location.href = '/index.html';\r\n            } else {\r\n                // Estamos en la app principal, cargar todo\r\n                inicializarApp();\r\n            }\r\n        } else {\r\n            // Usuario no est√° logueado\r\n            console.log('Usuario no autenticado.');\r\n            estadoApp.datos.usuario = null;\r\n            // Si no estamos en login/signup, redirigir a login\r\n            if (!window.location.pathname.includes('login.html') && !window.location.pathname.includes('signup.html')) {\r\n                window.location.href = '/login.html';\r\n            }\r\n        }\r\n    });\r\n});\r\n\r\n\r\n// Funci√≥n que se ejecuta una vez que el usuario est√° autenticado\r\nfunction inicializarApp() {\r\n    console.log('Inicializando aplicaci√≥n...');\r\n    \r\n    // Configurar el bot√≥n de logout\r\n    const logoutButton = document.getElementById('logout-button');\r\n    if (logoutButton) {\r\n        logoutButton.addEventListener('click', async () => {\r\n            // Limpiar el estado de la aplicaci√≥n antes de cerrar sesi√≥n\r\n            limpiarEstadoApp();\r\n            const { error } = await supabase.auth.signOut();\r\n            if (error) {\r\n                mostrarAlerta('Error al cerrar sesi√≥n: ' + error.message, 'danger');\r\n            }\r\n            // onAuthStateChange se encargar√° de la redirecci√≥n a login.html\r\n            // y de limpiar la interfaz.\r\n        });\r\n    }\r\n\r\n    // Al iniciar sesi√≥n, limpiar cualquier dato residual y mostrar el dashboard.\r\n    // El dashboard cargar√° sus propios datos necesarios.\r\n    limpiarEstadoApp();\r\n    mostrarSeccion('dashboard');\r\n}\r\n\r\n// Funci√≥n para manejar el men√∫ en dispositivos m√≥viles\r\nfunction configurarMenuHamburguesa() {\r\n    const toggler = document.querySelector('.navbar-toggler');\r\n    const sidebar = document.querySelector('.sidebar');\r\n    const overlay = document.querySelector('.sidebar-overlay');\r\n\r\n    if (toggler && sidebar && overlay) {\r\n        toggler.addEventListener('click', () => {\r\n            sidebar.classList.toggle('show');\r\n            overlay.classList.toggle('show');\r\n        });\r\n\r\n        overlay.addEventListener('click', () => {\r\n            sidebar.classList.remove('show');\r\n            overlay.classList.remove('show');\r\n        });\r\n\r\n        // Ocultar men√∫ al hacer clic en una opci√≥n\r\n        sidebar.addEventListener('click', (e) => {\r\n            if (e.target.classList.contains('nav-link')) {\r\n                sidebar.classList.remove('show');\r\n                overlay.classList.remove('show');\r\n            }\r\n        });\r\n    }\r\n}\r\n// Nueva funci√≥n para limpiar el estado de la aplicaci√≥n\r\nfunction limpiarEstadoApp() {\r\n    console.log('Limpiando estado de la aplicaci√≥n...');\r\n    estadoApp.datos.clientes = [];\r\n    estadoApp.datos.productos = [];\r\n    estadoApp.datos.ventas = [];\r\n    estadoApp.datos.compras = [];\r\n    estadoApp.datos.usuario = null;\r\n\r\n    // Limpiar las tablas en la UI para que no se muestren datos viejos\r\n    document.getElementById('tablaClientes').innerHTML = '';\r\n    document.getElementById('tablaProductos').innerHTML = '';\r\n    document.getElementById('tablaVentas').innerHTML = '';\r\n    document.getElementById('tablaCompras').innerHTML = '';\r\n    // Limpiar tambi√©n el contenido del dashboard para evitar mostrar datos viejos\r\n    document.getElementById('topClientesContainer').innerHTML = '';\r\n    const chartCanvas = document.getElementById('chartProductosPopulares');\r\n    if (chartCanvas && chartCanvas.chart) chartCanvas.chart.destroy();\r\n}\r\n\r\nexport function actualizarEstadisticas() {\r\n    try {\r\n        const hoy = new Date().toISOString().split('T')[0];\r\n        const inicioMes = new Date();\r\n        inicioMes.setDate(1);\r\n        const inicioMesStr = inicioMes.toISOString().split('T')[0];\r\n        \r\n        // Calcular ventas de hoy\r\n        const ventasHoy = estadoApp.datos.ventas\r\n            .filter(v => v.fecha_venta && v.fecha_venta.startsWith(hoy))\r\n            .reduce((sum, v) => sum + (v.total || 0), 0);\r\n        \r\n        // Calcular ingresos del mes\r\n        const ingresosMes = estadoApp.datos.ventas\r\n            .filter(v => v.fecha_venta && v.fecha_venta >= inicioMesStr)\r\n            .reduce((sum, v) => sum + (v.total || 0), 0);\r\n        \r\n        // Actualizar elementos del DOM\r\n        const ventasHoyElement = document.getElementById('ventasHoy');\r\n        const ingresosMesElement = document.getElementById('ingresosMes');\r\n        const totalClientesElement = document.getElementById('totalClientes');\r\n        const totalProductosElement = document.getElementById('totalProductos');\r\n        \r\n        if (ventasHoyElement) ventasHoyElement.textContent = formatearMoneda(ventasHoy);\r\n        if (ingresosMesElement) ingresosMesElement.textContent = formatearMoneda(ingresosMes);\r\n        if (totalClientesElement) totalClientesElement.textContent = estadoApp.datos.clientes.length;\r\n        if (totalProductosElement) totalProductosElement.textContent = estadoApp.datos.productos.length;\r\n        \r\n    } catch (error) {\r\n        console.error('Error actualizando estad√≠sticas:', error);\r\n    }\r\n}\r\n\r\n// Exportar funciones globales para que est√©n disponibles en el HTML\r\nwindow.mostrarSeccion = mostrarSeccion;\r\nwindow.mostrarAlerta = mostrarAlerta;\r\nwindow.formatearFecha = formatearFecha;\r\nwindow.formatearMoneda = formatearMoneda;\r\nwindow.actualizarEstadisticas = actualizarEstadisticas;\r\n\r\n\r\nexport { cargarDashboard } from './dashboard.js';\r\nexport { cargarClientes } from './clientes.js';\r\nexport { cargarProductos } from './productos.js';\r\nexport { cargarVentas } from './ventas.js';\r\nexport { cargarCompras } from './compras.js';\r\nexport { cargarReportes } from './reportes.js';"],"names":["cargarDashboard","actualizarEstadisticas","actualizarVistasDashboard","configurarMenuSandwich","configurarBotonesDashboard","btnHoy","btnSemana","btnMes","filtrarDashboard","sandwichBtn","dashboardFilters","periodo","btn","botones","botonSeleccionado","ventasHoy","ingresosMes","totalVentasPeriodo","promedioVenta","calcularEstadisticasPorPeriodo","ventasHoyElement","ingresosMesElement","totalClientesElement","totalProductosElement","formatearMoneda","label","estadoApp","error","hoy","fechaInicio","ventasFiltradas","venta","fechaVenta","sum","inicioMes","datos","generarDatosDashboard","titulo","getTituloPeriodo","renderTablaTopClientes","ctxProductos","clientesAgrupados","clienteId","item","prodId","topClientes","a","b","productosAgrupados","productosPopularesArray","productosPopulares","nombre","cantidad","clientes","container","cliente","index","p","clienteEditandoId","cargarClientes","clientesAPI","actualizarTablaClientes","configurarModalCliente","mostrarAlerta","tbody","getBadgeClassForTipo","formatearFecha","tipo","mostrarModalCliente","editarCliente","c","guardarCliente","formulario","datosCliente","eliminarCliente","filtrarClientes","filtroNombre","filtroEmail","clientesFiltrados","limpiarFiltrosClientes","productoEditandoId","cargarProductos","actualizarTablaProductos","html","producto","mostrarModalProducto","productoId","guardarProducto","productoGuardado","productosAPI","editarProducto","eliminarProducto","filtrarProductos","filtroCategoria","filtroStock","productosFiltrados","limpiarFiltrosProductos","ventaEnCurso","cargarVentas","ventas","ventasAPI","actualizarTablaVentas","cargarSelectClientes","editarProductoVenta","modalHTML","modalAnterior","guardarEdicionProductoVenta","precio","actualizarResumenVenta","select","selectFiltro","opciones","cargarSelectProductos","mostrarModalVenta","agregarProductoVenta","cantidadInput","precioInput","precioPersonalizado","option","precioOriginal","stock","precioFinal","productoExistente","nuevaCantidad","listaProductos","subtotalElement","ivaElement","totalElement","precioModificado","badgePrecio","removerProductoVenta","guardarVenta","ventaData","ventaCreada","nuevoStock","actualizarStockProductos","productosVendidos","productoVendido","filtrarVentas","fechaFin","fechaFinObj","limpiarFiltrosVentas","verDetalleVentaModal","ventaId","v","clienteNombre","clienteEmail","productosHTML","eliminarVenta","actualizarEstadisticasDashboard","inicioMesStr","compraEnCurso","cargarCompras","compras","comprasAPI","actualizarTablaCompras","configurarModalCompra","compra","mostrarModalCompra","cargarSelectProductosCompra","actualizarResumenCompra","agregarProductoCompra","productoSeleccionado","removerProductoCompra","guardarCompra","proveedor","numeroFactura","compraData","compraCreada","verDetalleCompra","compraId","productosDetalle","productoNombre","detalle","eliminarCompra","reporteActual","cargarReportes","generarReporte","datosProcesados","procesarDatosReporte","actualizarTablaReportes","actualizarGraficosReportes","filtrarVentasPorFecha","generarReporteDiario","generarReporteMensual","generarReporteAnual","grupos","clave","grupo","formatearPeriodo","year","month","actualizarGraficoVentasPeriodo","actualizarGraficoCategorias","ctx","labels","valores","value","ventasPorCategoria","calcularVentasPorCategoria","val","categorias","categoria","subtotal","itemError","ventaError","cambiarPeriodoReporte","exportarReporte","contenido","generarContenidoExportacion","blob","url","generarReporteRapido","mostrarSeccion","seccion","sec","link","seccionElement","getTituloSeccion","cargarDatosSeccion","mensaje","alertContainer","alerta","getIconoAlerta","fechaString","monto","configurarMenuHamburguesa","supabase","event","session","inicializarApp","logoutButton","limpiarEstadoApp","toggler","sidebar","overlay","e","chartCanvas"],"mappings":"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"}